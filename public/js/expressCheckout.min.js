<<<<<<< HEAD
<<<<<<< HEAD
!function(n){var t={};function e(c){if(t[c])return t[c].exports;var I=t[c]={i:c,l:!1,exports:{}};return n[c].call(I.exports,I,I.exports,e),I.l=!0,I.exports}e.m=n,e.c=t,e.d=function(n,t,c){e.o(n,t)||Object.defineProperty(n,t,{enumerable:!0,get:c})},e.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},e.t=function(n,t){if(1&t&&(n=e(n)),8&t)return n;if(4&t&&"object"==typeof n&&n&&n.__esModule)return n;var c=Object.create(null);if(e.r(c),Object.defineProperty(c,"default",{enumerable:!0,value:n}),2&t&&"string"!=typeof n)for(var I in n)e.d(c,I,function(t){return n[t]}.bind(null,I));return c},e.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(t,"a",t),t},e.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},e.p="",e(e.s=1)}([,function(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n\n// CONCATENATED MODULE: ./resources/js/expressCheckout/Request.js\n/**\n * Class Request\n *\n * @type {Request}\n */\nconst Request = class Request\n{\n  // TODO Make the fields private if possible.\n  constructor (ajaxUrl, action)\n  {\n    this.ajaxUrl = ajaxUrl\n    this.action = action\n  }\n\n  formDataObject (formData)\n  {\n    const formDataEntries = [...formData.entries(), ['action', this.action]]\n    const dataObject = formDataEntries.reduce((obj, [key, value]) => {\n      obj[key] = value\n      return obj\n    }, {})\n\n    return dataObject\n  }\n\n  submit (formData)\n  {\n    // TODO Extract specific data such as: action, nonce, task, context and\n    //      put the rest within a specific object.\n    //      Make a separation for data controls and real request data.\n\n    const dataObject = this.formDataObject(formData)\n\n    if (_.isEmpty(dataObject)) {\n      return Promise.reject('No formData to send to the server.')\n    }\n\n    return new Promise((resolve, reject) => {\n      jQuery.ajax({\n        url: this.ajaxUrl,\n        method: 'POST',\n        data: dataObject,\n        error: reject,\n        success: resolve\n      })\n    })\n  }\n}\n\n/**\n * Request Factory\n *\n * @param ajaxUrl\n * @param action\n * @returns {Request}\n */\nfunction RequestFactory (ajaxUrl, action)\n{\n  if (!ajaxUrl || !action) {\n    throw new Error('Invalid parameters when construct Request instance')\n  }\n\n  let object = new Request(ajaxUrl, action)\n  Object.freeze(object)\n\n  return object\n}\n\n// CONCATENATED MODULE: ./resources/js/expressCheckout/context.js\n/**\n * Retrieve Context by Element\n *\n * @param element\n * @returns {string}\n */\nfunction contextByElement (element)\n{\n  return ('context' in element.dataset ? element.dataset.context : '')\n}\n\n// CONCATENATED MODULE: ./resources/js/expressCheckout/form.js\n\n\nconst CART_BUTTON_SELECTOR = 'woo-paypalplus-checkout-nonce'\n\n/**\n * Create a FormData object by the closest form of the given element\n *\n * @param element\n * @returns {FormData}\n */\nfunction formDataByElement (element)\n{\n  const form = element.closest('form')\n\n  if (!form) {\n    throw new Error(\n      'Unable to retrieve form. Form element does not exists or is not a parent of the given element.'\n    )\n  }\n\n  const formData = new FormData(form)\n  formData.append('context', contextByElement(element))\n\n  return formData\n}\n\n/**\n * Create a FormData for the Cart\n * WooCommerce mini cart doesn't have any form associated with it\n *\n * @param element\n * @returns {FormData}\n */\nfunction formDataForCart (element)\n{\n  try {\n    const [nonceName, nonceValue] = retrieveNonceForCart(element)\n    const formData = new FormData()\n\n    formData.append('context', contextByElement(element))\n    formData.append(nonceName, nonceValue)\n\n    return formData\n  } catch (err) {\n    return new FormData()\n  }\n}\n\nfunction retrieveNonceForCart (element)\n{\n  const nonceElement = element.parentNode.querySelector(`.${CART_BUTTON_SELECTOR}`)\n\n  if (!nonceElement) {\n    throw new Error('Cannot build the form data, missing security nonce.')\n  }\n\n  const nonceName = ('noncename' in nonceElement.dataset) ? nonceElement.dataset.noncename : ''\n  const nonceValue = ('noncevalue' in nonceElement.dataset) ? nonceElement.dataset.noncevalue : ''\n\n  if (!nonceName || !nonceValue) {\n    throw new Error('Cannot build the form data, missing security nonce.')\n  }\n\n  return [\n    nonceName,\n    nonceValue\n  ]\n}\n\n// CONCATENATED MODULE: ./resources/js/expressCheckout/smartPaymentButton.js\n\n\n\nconst SINGLE_PRODUCT_BUTTON = 'paypalplus_ecs_single_product_button'\nconst CART_BUTTON = 'paypalplus_ecs_cart_button'\n\nconst TASK_CREATE_ORDER = 'createOrder'\nconst TASK_STORE_PAYMENT_DATA = 'storePaymentData'\n\n/**\n * Class Smart Payment Button Renderer\n *\n * @type {SmartPaymentButtonRenderer}\n */\nconst smartPaymentButton_SmartPaymentButtonRenderer = class SmartPaymentButtonRenderer\n{\n  /**\n   * Constructor\n   *\n   * @param buttonConfiguration\n   * @param validContexts\n   * @param request\n   */\n  constructor (buttonConfiguration, validContexts, request)\n  {\n    this.buttonConfiguration = buttonConfiguration\n    this.validContexts = Array.from(validContexts)\n    this.request = request\n  }\n\n  /**\n   * Render button for single product\n   */\n  singleProductButtonRender ()\n  {\n    const element = document.querySelector(`#${SINGLE_PRODUCT_BUTTON}`)\n    element && this.render(element)\n  }\n\n  /**\n   * Render Button for Cart\n   */\n  cartButtonRender ()\n  {\n    const element = document.querySelector(`#${CART_BUTTON}`)\n    element && this.render(element)\n  }\n\n  /**\n   * Render Button for the Given Element\n   *\n   * @param element\n   * @returns {*}\n   */\n  // TODO Make it private\n  render (element)\n  {\n    if (_.isUndefined(paypal)) {\n      return\n    }\n\n    const button = element.querySelector('.paypal-button')\n    button && button.remove()\n\n    paypal.Button.render({\n      ...this.buttonConfiguration,\n\n      /**\n       * Do Payment\n       *\n       * @returns {*}\n       */\n      payment: () => {\n        const formData = this.formDataByElement(element)\n        formData.append('task', TASK_CREATE_ORDER)\n\n        return this.request\n          .submit(formData)\n          .then(response => {\n            if (!('data' in response)) {\n              // TODO Do something to inform user about the problem and close the flow.\n            }\n\n            const orderId = 'orderID' in response.data ? response.data.orderID : ''\n            if (!orderId) {\n              // TODO Do something to inform user about the problem and close the flow.\n            }\n\n            return orderId\n          })\n      },\n\n      /**\n       * Execute Authorization\n       *\n       * @param data\n       * @param actions\n       * @returns {*}\n       */\n      onAuthorize: (data, actions) => {\n        // TODO Ensure return_url exists.\n        const formData = this.formDataByElement(element)\n\n        formData.append('task', TASK_STORE_PAYMENT_DATA)\n        formData.append('orderID', data.orderID)\n        formData.append('payerID', data.payerID)\n        formData.append('paymentID', data.paymentID)\n        formData.append('paymentToken', data.paymentToken)\n\n        return this.request\n          .submit(formData)\n          .then((response) => {\n            if (response.success) {\n              const returnUrl = 'returnUrl' in data ? data.returnUrl : ''\n              returnUrl && actions.redirect(null, returnUrl)\n            }\n\n            // TODO Show alert to the user\n          })\n      },\n\n      /**\n       * Perform Action when a Payment get Cancelled\n       *\n       * @param data\n       * @param actions\n       */\n      onCancel: (data, actions) => {\n        actions.close()\n        const cancelUrl = 'cancelUrl' in data ? data.cancelUrl : ''\n        cancelUrl && actions.redirect(null, cancelUrl)\n      },\n\n      onError: (data, actions) => {\n        console.log('ON ERROR', data, actions)\n        // TODO Redirect to cart and show customizable notice with message.\n      }\n\n    }, element)\n  }\n\n  /**\n   * Retrieve context for FormData instance by the Given Element\n   *\n   * @param element\n   * @returns {FormData}\n   */\n  // TODO Make it private if not possible move it as closure within the render function.\n  formDataByElement (element)\n  {\n    let formData = new FormData()\n    const context = contextByElement(element)\n\n    if (!this.validContexts.includes(context)) {\n      throw new Error(\n        'Invalid context when try to retrieve the form data during express checkout request.'\n      )\n    }\n\n    try {\n      switch (context) {\n        case 'cart':\n          formData = formDataForCart(element)\n          break\n        case 'product':\n          formData = formDataByElement(element)\n          break\n      }\n    } catch (err) {\n    }\n\n    return formData\n  }\n}\n\n/**\n * Smart Payment Button Renderer Factory\n *\n * @param buttonConfiguration\n * @param validContexts\n * @param request\n * @returns {SmartPaymentButtonRenderer}\n * @constructor\n */\nfunction SmartPaymentButtonRendererFactory (buttonConfiguration, validContexts, request)\n{\n  const object = new smartPaymentButton_SmartPaymentButtonRenderer(buttonConfiguration, validContexts, request)\n\n  Object.freeze(object)\n\n  return object\n}\n\n// CONCATENATED MODULE: ./resources/js/expressCheckout.js\n\n\n\n(function (jQuery, _, expressCheckoutData) {\n  /**\n   * Ensure the Global Express Checkout is a Valid Value\n   * @returns {boolean}\n   */\n  function isValidExpressCheckoutData ()\n  {\n    return !_.isUndefined(expressCheckoutData) && !_.isEmpty(expressCheckoutData)\n  }\n\n  /**\n   * Bootstrap Express checkout\n   * @returns void\n   */\n  function bootstrapExpressCheckout ()\n  {\n    if (!isValidExpressCheckoutData()) {\n      return\n    }\n\n    const requestData = expressCheckoutData.request\n    if (!_.isObject(requestData)) {\n      return\n    }\n\n    const validContexts = expressCheckoutData.validContexts\n    if (!_.isArray(validContexts)) {\n      return\n    }\n\n    const request = RequestFactory(requestData.ajaxUrl, requestData.action)\n    const smartPaymentButton = SmartPaymentButtonRendererFactory(\n      expressCheckoutData,\n      validContexts,\n      request\n    )\n\n    smartPaymentButton.singleProductButtonRender()\n    smartPaymentButton.cartButtonRender()\n    jQuery(document.body).on('wc_fragments_refreshed removed_from_cart added_to_cart', () => {\n      smartPaymentButton.cartButtonRender()\n    })\n  }\n\n  window.addEventListener('load', () => {\n    bootstrapExpressCheckout()\n  })\n})(jQuery, window._, window.wooPayPalPlusExpressCheckout)\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9yZXNvdXJjZXMvanMvZXhwcmVzc0NoZWNrb3V0L1JlcXVlc3QuanM/OGQ1ZiIsIndlYnBhY2s6Ly8vLi9yZXNvdXJjZXMvanMvZXhwcmVzc0NoZWNrb3V0L2NvbnRleHQuanM/NjhkMyIsIndlYnBhY2s6Ly8vLi9yZXNvdXJjZXMvanMvZXhwcmVzc0NoZWNrb3V0L2Zvcm0uanM/ZWE1ZCIsIndlYnBhY2s6Ly8vLi9yZXNvdXJjZXMvanMvZXhwcmVzc0NoZWNrb3V0L3NtYXJ0UGF5bWVudEJ1dHRvbi5qcz9mM2IyIiwid2VicGFjazovLy8uL3Jlc291cmNlcy9qcy9leHByZXNzQ2hlY2tvdXQuanM/ZGNjMyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUssSUFBSTs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7O0FDbEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ087QUFDUDtBQUNBO0FBQ0E7OztBQ1Q0Qzs7QUFFNUM7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDTztBQUNQO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDZCQUE2QixnQkFBZ0I7O0FBRTdDO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsK0JBQStCLGdCQUFnQjtBQUMvQzs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLDREQUE0RCxxQkFBcUI7O0FBRWpGO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUNuRTJEO0FBQ2Y7O0FBRTVDO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQSxNQUFNLDZDQUEwQjtBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBK0Msc0JBQXNCO0FBQ3JFO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtDQUErQyxZQUFZO0FBQzNEO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQjtBQUNuQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxXQUFXO0FBQ1gsT0FBTzs7QUFFUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxXQUFXO0FBQ1gsT0FBTzs7QUFFUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87O0FBRVA7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsS0FBSztBQUNMOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsZ0JBQWdCOztBQUVwQztBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQixlQUFlO0FBQ3BDO0FBQ0E7QUFDQSxxQkFBcUIsaUJBQWlCO0FBQ3RDO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ087QUFDUDtBQUNBLHFCQUFxQiw2Q0FBMEI7O0FBRS9DOztBQUVBO0FBQ0E7OztBQy9MMEQ7QUFDOEI7O0FBRXhGO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxvQkFBb0IsY0FBYztBQUNsQywrQkFBK0IsaUNBQWlDO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsQ0FBQyIsImZpbGUiOiIxLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDbGFzcyBSZXF1ZXN0XG4gKlxuICogQHR5cGUge1JlcXVlc3R9XG4gKi9cbmNvbnN0IFJlcXVlc3QgPSBjbGFzcyBSZXF1ZXN0XG57XG4gIC8vIFRPRE8gTWFrZSB0aGUgZmllbGRzIHByaXZhdGUgaWYgcG9zc2libGUuXG4gIGNvbnN0cnVjdG9yIChhamF4VXJsLCBhY3Rpb24pXG4gIHtcbiAgICB0aGlzLmFqYXhVcmwgPSBhamF4VXJsXG4gICAgdGhpcy5hY3Rpb24gPSBhY3Rpb25cbiAgfVxuXG4gIGZvcm1EYXRhT2JqZWN0IChmb3JtRGF0YSlcbiAge1xuICAgIGNvbnN0IGZvcm1EYXRhRW50cmllcyA9IFsuLi5mb3JtRGF0YS5lbnRyaWVzKCksIFsnYWN0aW9uJywgdGhpcy5hY3Rpb25dXVxuICAgIGNvbnN0IGRhdGFPYmplY3QgPSBmb3JtRGF0YUVudHJpZXMucmVkdWNlKChvYmosIFtrZXksIHZhbHVlXSkgPT4ge1xuICAgICAgb2JqW2tleV0gPSB2YWx1ZVxuICAgICAgcmV0dXJuIG9ialxuICAgIH0sIHt9KVxuXG4gICAgcmV0dXJuIGRhdGFPYmplY3RcbiAgfVxuXG4gIHN1Ym1pdCAoZm9ybURhdGEpXG4gIHtcbiAgICAvLyBUT0RPIEV4dHJhY3Qgc3BlY2lmaWMgZGF0YSBzdWNoIGFzOiBhY3Rpb24sIG5vbmNlLCB0YXNrLCBjb250ZXh0IGFuZFxuICAgIC8vICAgICAgcHV0IHRoZSByZXN0IHdpdGhpbiBhIHNwZWNpZmljIG9iamVjdC5cbiAgICAvLyAgICAgIE1ha2UgYSBzZXBhcmF0aW9uIGZvciBkYXRhIGNvbnRyb2xzIGFuZCByZWFsIHJlcXVlc3QgZGF0YS5cblxuICAgIGNvbnN0IGRhdGFPYmplY3QgPSB0aGlzLmZvcm1EYXRhT2JqZWN0KGZvcm1EYXRhKVxuXG4gICAgaWYgKF8uaXNFbXB0eShkYXRhT2JqZWN0KSkge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KCdObyBmb3JtRGF0YSB0byBzZW5kIHRvIHRoZSBzZXJ2ZXIuJylcbiAgICB9XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgalF1ZXJ5LmFqYXgoe1xuICAgICAgICB1cmw6IHRoaXMuYWpheFVybCxcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIGRhdGE6IGRhdGFPYmplY3QsXG4gICAgICAgIGVycm9yOiByZWplY3QsXG4gICAgICAgIHN1Y2Nlc3M6IHJlc29sdmVcbiAgICAgIH0pXG4gICAgfSlcbiAgfVxufVxuXG4vKipcbiAqIFJlcXVlc3QgRmFjdG9yeVxuICpcbiAqIEBwYXJhbSBhamF4VXJsXG4gKiBAcGFyYW0gYWN0aW9uXG4gKiBAcmV0dXJucyB7UmVxdWVzdH1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIFJlcXVlc3RGYWN0b3J5IChhamF4VXJsLCBhY3Rpb24pXG57XG4gIGlmICghYWpheFVybCB8fCAhYWN0aW9uKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHBhcmFtZXRlcnMgd2hlbiBjb25zdHJ1Y3QgUmVxdWVzdCBpbnN0YW5jZScpXG4gIH1cblxuICBsZXQgb2JqZWN0ID0gbmV3IFJlcXVlc3QoYWpheFVybCwgYWN0aW9uKVxuICBPYmplY3QuZnJlZXplKG9iamVjdClcblxuICByZXR1cm4gb2JqZWN0XG59XG4iLCIvKipcbiAqIFJldHJpZXZlIENvbnRleHQgYnkgRWxlbWVudFxuICpcbiAqIEBwYXJhbSBlbGVtZW50XG4gKiBAcmV0dXJucyB7c3RyaW5nfVxuICovXG5leHBvcnQgZnVuY3Rpb24gY29udGV4dEJ5RWxlbWVudCAoZWxlbWVudClcbntcbiAgcmV0dXJuICgnY29udGV4dCcgaW4gZWxlbWVudC5kYXRhc2V0ID8gZWxlbWVudC5kYXRhc2V0LmNvbnRleHQgOiAnJylcbn1cbiIsImltcG9ydCB7IGNvbnRleHRCeUVsZW1lbnQgfSBmcm9tICcuL2NvbnRleHQnXG5cbmNvbnN0IENBUlRfQlVUVE9OX1NFTEVDVE9SID0gJ3dvby1wYXlwYWxwbHVzLWNoZWNrb3V0LW5vbmNlJ1xuXG4vKipcbiAqIENyZWF0ZSBhIEZvcm1EYXRhIG9iamVjdCBieSB0aGUgY2xvc2VzdCBmb3JtIG9mIHRoZSBnaXZlbiBlbGVtZW50XG4gKlxuICogQHBhcmFtIGVsZW1lbnRcbiAqIEByZXR1cm5zIHtGb3JtRGF0YX1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGZvcm1EYXRhQnlFbGVtZW50IChlbGVtZW50KVxue1xuICBjb25zdCBmb3JtID0gZWxlbWVudC5jbG9zZXN0KCdmb3JtJylcblxuICBpZiAoIWZvcm0pIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAnVW5hYmxlIHRvIHJldHJpZXZlIGZvcm0uIEZvcm0gZWxlbWVudCBkb2VzIG5vdCBleGlzdHMgb3IgaXMgbm90IGEgcGFyZW50IG9mIHRoZSBnaXZlbiBlbGVtZW50LidcbiAgICApXG4gIH1cblxuICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YShmb3JtKVxuICBmb3JtRGF0YS5hcHBlbmQoJ2NvbnRleHQnLCBjb250ZXh0QnlFbGVtZW50KGVsZW1lbnQpKVxuXG4gIHJldHVybiBmb3JtRGF0YVxufVxuXG4vKipcbiAqIENyZWF0ZSBhIEZvcm1EYXRhIGZvciB0aGUgQ2FydFxuICogV29vQ29tbWVyY2UgbWluaSBjYXJ0IGRvZXNuJ3QgaGF2ZSBhbnkgZm9ybSBhc3NvY2lhdGVkIHdpdGggaXRcbiAqXG4gKiBAcGFyYW0gZWxlbWVudFxuICogQHJldHVybnMge0Zvcm1EYXRhfVxuICovXG5leHBvcnQgZnVuY3Rpb24gZm9ybURhdGFGb3JDYXJ0IChlbGVtZW50KVxue1xuICB0cnkge1xuICAgIGNvbnN0IFtub25jZU5hbWUsIG5vbmNlVmFsdWVdID0gcmV0cmlldmVOb25jZUZvckNhcnQoZWxlbWVudClcbiAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpXG5cbiAgICBmb3JtRGF0YS5hcHBlbmQoJ2NvbnRleHQnLCBjb250ZXh0QnlFbGVtZW50KGVsZW1lbnQpKVxuICAgIGZvcm1EYXRhLmFwcGVuZChub25jZU5hbWUsIG5vbmNlVmFsdWUpXG5cbiAgICByZXR1cm4gZm9ybURhdGFcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgcmV0dXJuIG5ldyBGb3JtRGF0YSgpXG4gIH1cbn1cblxuZnVuY3Rpb24gcmV0cmlldmVOb25jZUZvckNhcnQgKGVsZW1lbnQpXG57XG4gIGNvbnN0IG5vbmNlRWxlbWVudCA9IGVsZW1lbnQucGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yKGAuJHtDQVJUX0JVVFRPTl9TRUxFQ1RPUn1gKVxuXG4gIGlmICghbm9uY2VFbGVtZW50KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgYnVpbGQgdGhlIGZvcm0gZGF0YSwgbWlzc2luZyBzZWN1cml0eSBub25jZS4nKVxuICB9XG5cbiAgY29uc3Qgbm9uY2VOYW1lID0gKCdub25jZW5hbWUnIGluIG5vbmNlRWxlbWVudC5kYXRhc2V0KSA/IG5vbmNlRWxlbWVudC5kYXRhc2V0Lm5vbmNlbmFtZSA6ICcnXG4gIGNvbnN0IG5vbmNlVmFsdWUgPSAoJ25vbmNldmFsdWUnIGluIG5vbmNlRWxlbWVudC5kYXRhc2V0KSA/IG5vbmNlRWxlbWVudC5kYXRhc2V0Lm5vbmNldmFsdWUgOiAnJ1xuXG4gIGlmICghbm9uY2VOYW1lIHx8ICFub25jZVZhbHVlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgYnVpbGQgdGhlIGZvcm0gZGF0YSwgbWlzc2luZyBzZWN1cml0eSBub25jZS4nKVxuICB9XG5cbiAgcmV0dXJuIFtcbiAgICBub25jZU5hbWUsXG4gICAgbm9uY2VWYWx1ZVxuICBdXG59XG4iLCJpbXBvcnQgeyBmb3JtRGF0YUJ5RWxlbWVudCwgZm9ybURhdGFGb3JDYXJ0IH0gZnJvbSAnLi9mb3JtJ1xuaW1wb3J0IHsgY29udGV4dEJ5RWxlbWVudCB9IGZyb20gJy4vY29udGV4dCdcblxuY29uc3QgU0lOR0xFX1BST0RVQ1RfQlVUVE9OID0gJ3BheXBhbHBsdXNfZWNzX3NpbmdsZV9wcm9kdWN0X2J1dHRvbidcbmNvbnN0IENBUlRfQlVUVE9OID0gJ3BheXBhbHBsdXNfZWNzX2NhcnRfYnV0dG9uJ1xuXG5jb25zdCBUQVNLX0NSRUFURV9PUkRFUiA9ICdjcmVhdGVPcmRlcidcbmNvbnN0IFRBU0tfU1RPUkVfUEFZTUVOVF9EQVRBID0gJ3N0b3JlUGF5bWVudERhdGEnXG5cbi8qKlxuICogQ2xhc3MgU21hcnQgUGF5bWVudCBCdXR0b24gUmVuZGVyZXJcbiAqXG4gKiBAdHlwZSB7U21hcnRQYXltZW50QnV0dG9uUmVuZGVyZXJ9XG4gKi9cbmNvbnN0IFNtYXJ0UGF5bWVudEJ1dHRvblJlbmRlcmVyID0gY2xhc3MgU21hcnRQYXltZW50QnV0dG9uUmVuZGVyZXJcbntcbiAgLyoqXG4gICAqIENvbnN0cnVjdG9yXG4gICAqXG4gICAqIEBwYXJhbSBidXR0b25Db25maWd1cmF0aW9uXG4gICAqIEBwYXJhbSB2YWxpZENvbnRleHRzXG4gICAqIEBwYXJhbSByZXF1ZXN0XG4gICAqL1xuICBjb25zdHJ1Y3RvciAoYnV0dG9uQ29uZmlndXJhdGlvbiwgdmFsaWRDb250ZXh0cywgcmVxdWVzdClcbiAge1xuICAgIHRoaXMuYnV0dG9uQ29uZmlndXJhdGlvbiA9IGJ1dHRvbkNvbmZpZ3VyYXRpb25cbiAgICB0aGlzLnZhbGlkQ29udGV4dHMgPSBBcnJheS5mcm9tKHZhbGlkQ29udGV4dHMpXG4gICAgdGhpcy5yZXF1ZXN0ID0gcmVxdWVzdFxuICB9XG5cbiAgLyoqXG4gICAqIFJlbmRlciBidXR0b24gZm9yIHNpbmdsZSBwcm9kdWN0XG4gICAqL1xuICBzaW5nbGVQcm9kdWN0QnV0dG9uUmVuZGVyICgpXG4gIHtcbiAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgIyR7U0lOR0xFX1BST0RVQ1RfQlVUVE9OfWApXG4gICAgZWxlbWVudCAmJiB0aGlzLnJlbmRlcihlbGVtZW50KVxuICB9XG5cbiAgLyoqXG4gICAqIFJlbmRlciBCdXR0b24gZm9yIENhcnRcbiAgICovXG4gIGNhcnRCdXR0b25SZW5kZXIgKClcbiAge1xuICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjJHtDQVJUX0JVVFRPTn1gKVxuICAgIGVsZW1lbnQgJiYgdGhpcy5yZW5kZXIoZWxlbWVudClcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW5kZXIgQnV0dG9uIGZvciB0aGUgR2l2ZW4gRWxlbWVudFxuICAgKlxuICAgKiBAcGFyYW0gZWxlbWVudFxuICAgKiBAcmV0dXJucyB7Kn1cbiAgICovXG4gIC8vIFRPRE8gTWFrZSBpdCBwcml2YXRlXG4gIHJlbmRlciAoZWxlbWVudClcbiAge1xuICAgIGlmIChfLmlzVW5kZWZpbmVkKHBheXBhbCkpIHtcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIGNvbnN0IGJ1dHRvbiA9IGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnBheXBhbC1idXR0b24nKVxuICAgIGJ1dHRvbiAmJiBidXR0b24ucmVtb3ZlKClcblxuICAgIHBheXBhbC5CdXR0b24ucmVuZGVyKHtcbiAgICAgIC4uLnRoaXMuYnV0dG9uQ29uZmlndXJhdGlvbixcblxuICAgICAgLyoqXG4gICAgICAgKiBEbyBQYXltZW50XG4gICAgICAgKlxuICAgICAgICogQHJldHVybnMgeyp9XG4gICAgICAgKi9cbiAgICAgIHBheW1lbnQ6ICgpID0+IHtcbiAgICAgICAgY29uc3QgZm9ybURhdGEgPSB0aGlzLmZvcm1EYXRhQnlFbGVtZW50KGVsZW1lbnQpXG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZCgndGFzaycsIFRBU0tfQ1JFQVRFX09SREVSKVxuXG4gICAgICAgIHJldHVybiB0aGlzLnJlcXVlc3RcbiAgICAgICAgICAuc3VibWl0KGZvcm1EYXRhKVxuICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgIGlmICghKCdkYXRhJyBpbiByZXNwb25zZSkpIHtcbiAgICAgICAgICAgICAgLy8gVE9ETyBEbyBzb21ldGhpbmcgdG8gaW5mb3JtIHVzZXIgYWJvdXQgdGhlIHByb2JsZW0gYW5kIGNsb3NlIHRoZSBmbG93LlxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBvcmRlcklkID0gJ29yZGVySUQnIGluIHJlc3BvbnNlLmRhdGEgPyByZXNwb25zZS5kYXRhLm9yZGVySUQgOiAnJ1xuICAgICAgICAgICAgaWYgKCFvcmRlcklkKSB7XG4gICAgICAgICAgICAgIC8vIFRPRE8gRG8gc29tZXRoaW5nIHRvIGluZm9ybSB1c2VyIGFib3V0IHRoZSBwcm9ibGVtIGFuZCBjbG9zZSB0aGUgZmxvdy5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIG9yZGVySWRcbiAgICAgICAgICB9KVxuICAgICAgfSxcblxuICAgICAgLyoqXG4gICAgICAgKiBFeGVjdXRlIEF1dGhvcml6YXRpb25cbiAgICAgICAqXG4gICAgICAgKiBAcGFyYW0gZGF0YVxuICAgICAgICogQHBhcmFtIGFjdGlvbnNcbiAgICAgICAqIEByZXR1cm5zIHsqfVxuICAgICAgICovXG4gICAgICBvbkF1dGhvcml6ZTogKGRhdGEsIGFjdGlvbnMpID0+IHtcbiAgICAgICAgLy8gVE9ETyBFbnN1cmUgcmV0dXJuX3VybCBleGlzdHMuXG4gICAgICAgIGNvbnN0IGZvcm1EYXRhID0gdGhpcy5mb3JtRGF0YUJ5RWxlbWVudChlbGVtZW50KVxuXG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZCgndGFzaycsIFRBU0tfU1RPUkVfUEFZTUVOVF9EQVRBKVxuICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ29yZGVySUQnLCBkYXRhLm9yZGVySUQpXG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZCgncGF5ZXJJRCcsIGRhdGEucGF5ZXJJRClcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdwYXltZW50SUQnLCBkYXRhLnBheW1lbnRJRClcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdwYXltZW50VG9rZW4nLCBkYXRhLnBheW1lbnRUb2tlbilcblxuICAgICAgICByZXR1cm4gdGhpcy5yZXF1ZXN0XG4gICAgICAgICAgLnN1Ym1pdChmb3JtRGF0YSlcbiAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgIGNvbnN0IHJldHVyblVybCA9ICdyZXR1cm5VcmwnIGluIGRhdGEgPyBkYXRhLnJldHVyblVybCA6ICcnXG4gICAgICAgICAgICAgIHJldHVyblVybCAmJiBhY3Rpb25zLnJlZGlyZWN0KG51bGwsIHJldHVyblVybClcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gVE9ETyBTaG93IGFsZXJ0IHRvIHRoZSB1c2VyXG4gICAgICAgICAgfSlcbiAgICAgIH0sXG5cbiAgICAgIC8qKlxuICAgICAgICogUGVyZm9ybSBBY3Rpb24gd2hlbiBhIFBheW1lbnQgZ2V0IENhbmNlbGxlZFxuICAgICAgICpcbiAgICAgICAqIEBwYXJhbSBkYXRhXG4gICAgICAgKiBAcGFyYW0gYWN0aW9uc1xuICAgICAgICovXG4gICAgICBvbkNhbmNlbDogKGRhdGEsIGFjdGlvbnMpID0+IHtcbiAgICAgICAgYWN0aW9ucy5jbG9zZSgpXG4gICAgICAgIGNvbnN0IGNhbmNlbFVybCA9ICdjYW5jZWxVcmwnIGluIGRhdGEgPyBkYXRhLmNhbmNlbFVybCA6ICcnXG4gICAgICAgIGNhbmNlbFVybCAmJiBhY3Rpb25zLnJlZGlyZWN0KG51bGwsIGNhbmNlbFVybClcbiAgICAgIH0sXG5cbiAgICAgIG9uRXJyb3I6IChkYXRhLCBhY3Rpb25zKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdPTiBFUlJPUicsIGRhdGEsIGFjdGlvbnMpXG4gICAgICAgIC8vIFRPRE8gUmVkaXJlY3QgdG8gY2FydCBhbmQgc2hvdyBjdXN0b21pemFibGUgbm90aWNlIHdpdGggbWVzc2FnZS5cbiAgICAgIH1cblxuICAgIH0sIGVsZW1lbnQpXG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmUgY29udGV4dCBmb3IgRm9ybURhdGEgaW5zdGFuY2UgYnkgdGhlIEdpdmVuIEVsZW1lbnRcbiAgICpcbiAgICogQHBhcmFtIGVsZW1lbnRcbiAgICogQHJldHVybnMge0Zvcm1EYXRhfVxuICAgKi9cbiAgLy8gVE9ETyBNYWtlIGl0IHByaXZhdGUgaWYgbm90IHBvc3NpYmxlIG1vdmUgaXQgYXMgY2xvc3VyZSB3aXRoaW4gdGhlIHJlbmRlciBmdW5jdGlvbi5cbiAgZm9ybURhdGFCeUVsZW1lbnQgKGVsZW1lbnQpXG4gIHtcbiAgICBsZXQgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKVxuICAgIGNvbnN0IGNvbnRleHQgPSBjb250ZXh0QnlFbGVtZW50KGVsZW1lbnQpXG5cbiAgICBpZiAoIXRoaXMudmFsaWRDb250ZXh0cy5pbmNsdWRlcyhjb250ZXh0KSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAnSW52YWxpZCBjb250ZXh0IHdoZW4gdHJ5IHRvIHJldHJpZXZlIHRoZSBmb3JtIGRhdGEgZHVyaW5nIGV4cHJlc3MgY2hlY2tvdXQgcmVxdWVzdC4nXG4gICAgICApXG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIHN3aXRjaCAoY29udGV4dCkge1xuICAgICAgICBjYXNlICdjYXJ0JzpcbiAgICAgICAgICBmb3JtRGF0YSA9IGZvcm1EYXRhRm9yQ2FydChlbGVtZW50KVxuICAgICAgICAgIGJyZWFrXG4gICAgICAgIGNhc2UgJ3Byb2R1Y3QnOlxuICAgICAgICAgIGZvcm1EYXRhID0gZm9ybURhdGFCeUVsZW1lbnQoZWxlbWVudClcbiAgICAgICAgICBicmVha1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgIH1cblxuICAgIHJldHVybiBmb3JtRGF0YVxuICB9XG59XG5cbi8qKlxuICogU21hcnQgUGF5bWVudCBCdXR0b24gUmVuZGVyZXIgRmFjdG9yeVxuICpcbiAqIEBwYXJhbSBidXR0b25Db25maWd1cmF0aW9uXG4gKiBAcGFyYW0gdmFsaWRDb250ZXh0c1xuICogQHBhcmFtIHJlcXVlc3RcbiAqIEByZXR1cm5zIHtTbWFydFBheW1lbnRCdXR0b25SZW5kZXJlcn1cbiAqIEBjb25zdHJ1Y3RvclxuICovXG5leHBvcnQgZnVuY3Rpb24gU21hcnRQYXltZW50QnV0dG9uUmVuZGVyZXJGYWN0b3J5IChidXR0b25Db25maWd1cmF0aW9uLCB2YWxpZENvbnRleHRzLCByZXF1ZXN0KVxue1xuICBjb25zdCBvYmplY3QgPSBuZXcgU21hcnRQYXltZW50QnV0dG9uUmVuZGVyZXIoYnV0dG9uQ29uZmlndXJhdGlvbiwgdmFsaWRDb250ZXh0cywgcmVxdWVzdClcblxuICBPYmplY3QuZnJlZXplKG9iamVjdClcblxuICByZXR1cm4gb2JqZWN0XG59XG4iLCJpbXBvcnQgeyBSZXF1ZXN0RmFjdG9yeSB9IGZyb20gJy4vZXhwcmVzc0NoZWNrb3V0L1JlcXVlc3QnXG5pbXBvcnQgeyBTbWFydFBheW1lbnRCdXR0b25SZW5kZXJlckZhY3RvcnkgfSBmcm9tICcuL2V4cHJlc3NDaGVja291dC9zbWFydFBheW1lbnRCdXR0b24nXG5cbihmdW5jdGlvbiAoalF1ZXJ5LCBfLCBleHByZXNzQ2hlY2tvdXREYXRhKSB7XG4gIC8qKlxuICAgKiBFbnN1cmUgdGhlIEdsb2JhbCBFeHByZXNzIENoZWNrb3V0IGlzIGEgVmFsaWQgVmFsdWVcbiAgICogQHJldHVybnMge2Jvb2xlYW59XG4gICAqL1xuICBmdW5jdGlvbiBpc1ZhbGlkRXhwcmVzc0NoZWNrb3V0RGF0YSAoKVxuICB7XG4gICAgcmV0dXJuICFfLmlzVW5kZWZpbmVkKGV4cHJlc3NDaGVja291dERhdGEpICYmICFfLmlzRW1wdHkoZXhwcmVzc0NoZWNrb3V0RGF0YSlcbiAgfVxuXG4gIC8qKlxuICAgKiBCb290c3RyYXAgRXhwcmVzcyBjaGVja291dFxuICAgKiBAcmV0dXJucyB2b2lkXG4gICAqL1xuICBmdW5jdGlvbiBib290c3RyYXBFeHByZXNzQ2hlY2tvdXQgKClcbiAge1xuICAgIGlmICghaXNWYWxpZEV4cHJlc3NDaGVja291dERhdGEoKSkge1xuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgY29uc3QgcmVxdWVzdERhdGEgPSBleHByZXNzQ2hlY2tvdXREYXRhLnJlcXVlc3RcbiAgICBpZiAoIV8uaXNPYmplY3QocmVxdWVzdERhdGEpKSB7XG4gICAgICByZXR1cm5cbiAgICB9XG5cbiAgICBjb25zdCB2YWxpZENvbnRleHRzID0gZXhwcmVzc0NoZWNrb3V0RGF0YS52YWxpZENvbnRleHRzXG4gICAgaWYgKCFfLmlzQXJyYXkodmFsaWRDb250ZXh0cykpIHtcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIGNvbnN0IHJlcXVlc3QgPSBSZXF1ZXN0RmFjdG9yeShyZXF1ZXN0RGF0YS5hamF4VXJsLCByZXF1ZXN0RGF0YS5hY3Rpb24pXG4gICAgY29uc3Qgc21hcnRQYXltZW50QnV0dG9uID0gU21hcnRQYXltZW50QnV0dG9uUmVuZGVyZXJGYWN0b3J5KFxuICAgICAgZXhwcmVzc0NoZWNrb3V0RGF0YSxcbiAgICAgIHZhbGlkQ29udGV4dHMsXG4gICAgICByZXF1ZXN0XG4gICAgKVxuXG4gICAgc21hcnRQYXltZW50QnV0dG9uLnNpbmdsZVByb2R1Y3RCdXR0b25SZW5kZXIoKVxuICAgIHNtYXJ0UGF5bWVudEJ1dHRvbi5jYXJ0QnV0dG9uUmVuZGVyKClcbiAgICBqUXVlcnkoZG9jdW1lbnQuYm9keSkub24oJ3djX2ZyYWdtZW50c19yZWZyZXNoZWQgcmVtb3ZlZF9mcm9tX2NhcnQgYWRkZWRfdG9fY2FydCcsICgpID0+IHtcbiAgICAgIHNtYXJ0UGF5bWVudEJ1dHRvbi5jYXJ0QnV0dG9uUmVuZGVyKClcbiAgICB9KVxuICB9XG5cbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCAoKSA9PiB7XG4gICAgYm9vdHN0cmFwRXhwcmVzc0NoZWNrb3V0KClcbiAgfSlcbn0pKGpRdWVyeSwgd2luZG93Ll8sIHdpbmRvdy53b29QYXlQYWxQbHVzRXhwcmVzc0NoZWNrb3V0KVxuIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///1\n")}]);
=======
!function(n){var t={};function e(c){if(t[c])return t[c].exports;var g=t[c]={i:c,l:!1,exports:{}};return n[c].call(g.exports,g,g.exports,e),g.l=!0,g.exports}e.m=n,e.c=t,e.d=function(n,t,c){e.o(n,t)||Object.defineProperty(n,t,{enumerable:!0,get:c})},e.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},e.t=function(n,t){if(1&t&&(n=e(n)),8&t)return n;if(4&t&&"object"==typeof n&&n&&n.__esModule)return n;var c=Object.create(null);if(e.r(c),Object.defineProperty(c,"default",{enumerable:!0,value:n}),2&t&&"string"!=typeof n)for(var g in n)e.d(c,g,function(t){return n[t]}.bind(null,g));return c},e.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(t,"a",t),t},e.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},e.p="",e(e.s=1)}([,function(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n\n// CONCATENATED MODULE: ./resources/js/expressCheckout/Request.js\n/**\n * Class Request\n *\n * @type {Request}\n */\nconst Request = class Request\n{\n  // TODO Make the fields private if possible.\n  constructor (ajaxUrl, action)\n  {\n    this.ajaxUrl = ajaxUrl\n    this.action = action\n  }\n\n  formDataObject (formData)\n  {\n    const formDataEntries = [...formData.entries(), ['action', this.action]]\n    const dataObject = formDataEntries.reduce((obj, [key, value]) => {\n      obj[key] = value\n      return obj\n    }, {})\n\n    return dataObject\n  }\n\n  submit (formData)\n  {\n    // TODO Extract specific data such as: action, nonce, task, context and\n    //      put the rest within a specific object.\n    //      Make a separation for data controls and real request data.\n\n    const dataObject = this.formDataObject(formData)\n\n    if (_.isEmpty(dataObject)) {\n      return Promise.reject('No formData to send to the server.')\n    }\n\n    return new Promise((resolve, reject) => {\n      jQuery.ajax({\n        url: this.ajaxUrl,\n        method: 'POST',\n        data: dataObject,\n        error: reject,\n        success: resolve\n      })\n    })\n  }\n}\n\n/**\n * Request Factory\n *\n * @param ajaxUrl\n * @param action\n * @returns {Request}\n */\nfunction RequestFactory (ajaxUrl, action)\n{\n  if (!ajaxUrl || !action) {\n    throw new Error('Invalid parameters when construct Request instance')\n  }\n\n  let object = new Request(ajaxUrl, action)\n  Object.freeze(object)\n\n  return object\n}\n\n// CONCATENATED MODULE: ./resources/js/expressCheckout/context.js\n/**\n * Retrieve Context by Element\n *\n * @param element\n * @returns {string}\n */\nfunction contextByElement (element)\n{\n  return ('context' in element.dataset ? element.dataset.context : '')\n}\n\n// CONCATENATED MODULE: ./resources/js/expressCheckout/form.js\n\n\nconst CART_BUTTON_SELECTOR = 'woo-paypalplus-checkout-nonce'\n\n/**\n * Create a FormData object by the closest form of the given element\n *\n * @param element\n * @returns {FormData}\n */\nfunction formDataByElement (element)\n{\n  const form = element.closest('form')\n\n  if (!form) {\n    throw new Error(\n      'Unable to retrieve form. Form element does not exists or is not a parent of the given element.'\n    )\n  }\n\n  const formData = new FormData(form)\n  formData.append('context', contextByElement(element))\n\n  return formData\n}\n\n/**\n * Create a FormData for the Cart\n * WooCommerce mini cart doesn't have any form associated with it\n *\n * @param element\n * @returns {FormData}\n */\nfunction formDataForCart (element)\n{\n  try {\n    const [nonceName, nonceValue] = retrieveNonceForCart(element)\n    const formData = new FormData()\n\n    formData.append('context', contextByElement(element))\n    formData.append(nonceName, nonceValue)\n\n    return formData\n  } catch (err) {\n    return new FormData()\n  }\n}\n\nfunction retrieveNonceForCart (element)\n{\n  const nonceElement = element.parentNode.querySelector(`.${CART_BUTTON_SELECTOR}`)\n\n  if (!nonceElement) {\n    throw new Error('Cannot build the form data, missing security nonce.')\n  }\n\n  const nonceName = ('noncename' in nonceElement.dataset) ? nonceElement.dataset.noncename : ''\n  const nonceValue = ('noncevalue' in nonceElement.dataset) ? nonceElement.dataset.noncevalue : ''\n\n  if (!nonceName || !nonceValue) {\n    throw new Error('Cannot build the form data, missing security nonce.')\n  }\n\n  return [\n    nonceName,\n    nonceValue\n  ]\n}\n\n// CONCATENATED MODULE: ./resources/js/expressCheckout/smartPaymentButton.js\n\n\n\nconst SINGLE_PRODUCT_BUTTON = 'paypalplus_ecs_single_product_button'\nconst CART_BUTTON = 'paypalplus_ecs_cart_button'\n\nconst TASK_CREATE_ORDER = 'createOrder'\nconst TASK_STORE_PAYMENT_DATA = 'storePaymentData'\n\n/**\n * Class Smart Payment Button Renderer\n *\n * @type {SmartPaymentButtonRenderer}\n */\nconst smartPaymentButton_SmartPaymentButtonRenderer = class SmartPaymentButtonRenderer\n{\n  /**\n   * Constructor\n   *\n   * @param buttonConfiguration\n   * @param validContexts\n   * @param request\n   */\n  constructor (buttonConfiguration, validContexts, request)\n  {\n    this.buttonConfiguration = buttonConfiguration\n    this.validContexts = Array.from(validContexts)\n    this.request = request\n  }\n\n  /**\n   * Render button for single product\n   */\n  singleProductButtonRender ()\n  {\n    const element = document.querySelector(`#${SINGLE_PRODUCT_BUTTON}`)\n    element && this.render(element)\n  }\n\n  /**\n   * Render Button for Cart\n   */\n  cartButtonRender ()\n  {\n    const element = document.querySelector(`#${CART_BUTTON}`)\n    element && this.render(element)\n  }\n\n  /**\n   * Render Button for the Given Element\n   *\n   * @param element\n   * @returns {*}\n   */\n  // TODO Make it private\n  render (element)\n  {\n    if (_.isUndefined(paypal)) {\n      return\n    }\n\n    paypal.Button.render({\n      ...this.buttonConfiguration,\n\n      /**\n       * Do Payment\n       *\n       * @returns {*}\n       */\n      payment: () => {\n        const formData = this.formDataByElement(element)\n        formData.append('task', TASK_CREATE_ORDER)\n\n        return this.request\n          .submit(formData)\n          .then(response => {\n            if (!('data' in response)) {\n              console.warn('Unable to process the payment, server did not response with valid data')\n              return\n            }\n            if (!response.success) {\n              // TODO Do something to inform user about the problem and close the flow.\n            }\n\n            const orderId = 'orderID' in response.data ? response.data.orderID : ''\n            if (!orderId) {\n              // TODO Do something to inform user about the problem and close the flow.\n            }\n\n            return orderId\n          })\n          .catch(error => {\n            const textStatus = 'textStatus' in error ? error.textStatus : 'Unknown Error during payment'\n            console.warn(textStatus)\n          })\n      },\n\n      /**\n       * Execute Authorization\n       *\n       * @param data\n       * @param actions\n       * @returns {*}\n       */\n      onAuthorize: (data, actions) => {\n        // TODO Ensure return_url exists.\n        const formData = this.formDataByElement(element)\n\n        formData.append('task', TASK_STORE_PAYMENT_DATA)\n        formData.append('orderID', data.orderID)\n        formData.append('payerID', data.payerID)\n        formData.append('paymentID', data.paymentID)\n        formData.append('paymentToken', data.paymentToken)\n\n        return this.request\n          .submit(formData)\n          .then((response) => {\n            if (response.success) {\n              const returnUrl = 'returnUrl' in data ? data.returnUrl : ''\n              returnUrl && actions.redirect(null, returnUrl)\n            }\n\n            // TODO Show alert to the user\n          })\n      },\n\n      /**\n       * Perform Action when a Payment get Cancelled\n       *\n       * @param data\n       * @param actions\n       */\n      onCancel: (data, actions) => {\n        actions.close()\n        const cancelUrl = 'cancelUrl' in data ? data.cancelUrl : ''\n        cancelUrl && actions.redirect(null, cancelUrl)\n      },\n\n      onError: (data, actions) => {\n        console.log('ON ERROR', data, actions)\n        // TODO Redirect to cart and show customizable notice with message.\n      }\n\n    }, element)\n  }\n\n  /**\n   * Retrieve context for FormData instance by the Given Element\n   *\n   * @param element\n   * @returns {FormData}\n   */\n  // TODO Make it private if not possible move it as closure within the render function.\n  formDataByElement (element)\n  {\n    let formData = new FormData()\n    const context = contextByElement(element)\n\n    if (!this.validContexts.includes(context)) {\n      throw new Error(\n        'Invalid context when try to retrieve the form data during express checkout request.'\n      )\n    }\n\n    try {\n      switch (context) {\n        case 'cart':\n          formData = formDataForCart(element)\n          break\n        case 'product':\n          formData = formDataByElement(element)\n          break\n      }\n    } catch (err) {\n    }\n\n    return formData\n  }\n}\n\n/**\n * Smart Payment Button Renderer Factory\n *\n * @param buttonConfiguration\n * @param validContexts\n * @param request\n * @returns {SmartPaymentButtonRenderer}\n * @constructor\n */\nfunction SmartPaymentButtonRendererFactory (buttonConfiguration, validContexts, request)\n{\n  const object = new smartPaymentButton_SmartPaymentButtonRenderer(buttonConfiguration, validContexts, request)\n\n  Object.freeze(object)\n\n  return object\n}\n\n// CONCATENATED MODULE: ./resources/js/expressCheckout.js\n\n\n\n(function (jQuery, _, expressCheckoutData) {\n  /**\n   * Ensure the Global Express Checkout is a Valid Value\n   * @returns {boolean}\n   */\n  function isValidExpressCheckoutData ()\n  {\n    return !_.isUndefined(expressCheckoutData) && !_.isEmpty(expressCheckoutData)\n  }\n\n  /**\n   * Bootstrap Express checkout\n   * @returns void\n   */\n  function bootstrapExpressCheckout ()\n  {\n    if (!isValidExpressCheckoutData()) {\n      return\n    }\n\n    const requestData = expressCheckoutData.request\n    if (!_.isObject(requestData)) {\n      return\n    }\n\n    const validContexts = expressCheckoutData.validContexts\n    if (!_.isArray(validContexts)) {\n      return\n    }\n\n    const request = RequestFactory(requestData.ajaxUrl, requestData.action)\n    const smartPaymentButton = SmartPaymentButtonRendererFactory(\n      expressCheckoutData,\n      validContexts,\n      request\n    )\n\n    smartPaymentButton.singleProductButtonRender()\n    smartPaymentButton.cartButtonRender()\n    jQuery(document.body).on('wc_fragments_refreshed removed_from_cart added_to_cart', () => {\n      smartPaymentButton.cartButtonRender()\n    })\n  }\n\n  window.addEventListener('load', () => {\n    bootstrapExpressCheckout()\n  })\n})(jQuery, window._, window.wooPayPalPlusExpressCheckout)\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9yZXNvdXJjZXMvanMvZXhwcmVzc0NoZWNrb3V0L1JlcXVlc3QuanM/OGQ1ZiIsIndlYnBhY2s6Ly8vLi9yZXNvdXJjZXMvanMvZXhwcmVzc0NoZWNrb3V0L2NvbnRleHQuanM/NjhkMyIsIndlYnBhY2s6Ly8vLi9yZXNvdXJjZXMvanMvZXhwcmVzc0NoZWNrb3V0L2Zvcm0uanM/ZWE1ZCIsIndlYnBhY2s6Ly8vLi9yZXNvdXJjZXMvanMvZXhwcmVzc0NoZWNrb3V0L3NtYXJ0UGF5bWVudEJ1dHRvbi5qcz9mM2IyIiwid2VicGFjazovLy8uL3Jlc291cmNlcy9qcy9leHByZXNzQ2hlY2tvdXQuanM/ZGNjMyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUssSUFBSTs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7O0FDbEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ087QUFDUDtBQUNBO0FBQ0E7OztBQ1Q0Qzs7QUFFNUM7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDTztBQUNQO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDZCQUE2QixnQkFBZ0I7O0FBRTdDO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsK0JBQStCLGdCQUFnQjtBQUMvQzs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLDREQUE0RCxxQkFBcUI7O0FBRWpGO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUNuRTJEO0FBQ2Y7O0FBRTVDO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQSxNQUFNLDZDQUEwQjtBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBK0Msc0JBQXNCO0FBQ3JFO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtDQUErQyxZQUFZO0FBQzNEO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUI7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYLE9BQU87O0FBRVA7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQjtBQUNuQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsV0FBVztBQUNYLE9BQU87O0FBRVA7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPOztBQUVQO0FBQ0E7QUFDQTtBQUNBOztBQUVBLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGdCQUFnQjs7QUFFcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUIsZUFBZTtBQUNwQztBQUNBO0FBQ0EscUJBQXFCLGlCQUFpQjtBQUN0QztBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNPO0FBQ1A7QUFDQSxxQkFBcUIsNkNBQTBCOztBQUUvQzs7QUFFQTtBQUNBOzs7QUNwTTBEO0FBQzhCOztBQUV4RjtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsb0JBQW9CLGNBQWM7QUFDbEMsK0JBQStCLGlDQUFpQztBQUNoRTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNILENBQUMiLCJmaWxlIjoiMS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ2xhc3MgUmVxdWVzdFxuICpcbiAqIEB0eXBlIHtSZXF1ZXN0fVxuICovXG5jb25zdCBSZXF1ZXN0ID0gY2xhc3MgUmVxdWVzdFxue1xuICAvLyBUT0RPIE1ha2UgdGhlIGZpZWxkcyBwcml2YXRlIGlmIHBvc3NpYmxlLlxuICBjb25zdHJ1Y3RvciAoYWpheFVybCwgYWN0aW9uKVxuICB7XG4gICAgdGhpcy5hamF4VXJsID0gYWpheFVybFxuICAgIHRoaXMuYWN0aW9uID0gYWN0aW9uXG4gIH1cblxuICBmb3JtRGF0YU9iamVjdCAoZm9ybURhdGEpXG4gIHtcbiAgICBjb25zdCBmb3JtRGF0YUVudHJpZXMgPSBbLi4uZm9ybURhdGEuZW50cmllcygpLCBbJ2FjdGlvbicsIHRoaXMuYWN0aW9uXV1cbiAgICBjb25zdCBkYXRhT2JqZWN0ID0gZm9ybURhdGFFbnRyaWVzLnJlZHVjZSgob2JqLCBba2V5LCB2YWx1ZV0pID0+IHtcbiAgICAgIG9ialtrZXldID0gdmFsdWVcbiAgICAgIHJldHVybiBvYmpcbiAgICB9LCB7fSlcblxuICAgIHJldHVybiBkYXRhT2JqZWN0XG4gIH1cblxuICBzdWJtaXQgKGZvcm1EYXRhKVxuICB7XG4gICAgLy8gVE9ETyBFeHRyYWN0IHNwZWNpZmljIGRhdGEgc3VjaCBhczogYWN0aW9uLCBub25jZSwgdGFzaywgY29udGV4dCBhbmRcbiAgICAvLyAgICAgIHB1dCB0aGUgcmVzdCB3aXRoaW4gYSBzcGVjaWZpYyBvYmplY3QuXG4gICAgLy8gICAgICBNYWtlIGEgc2VwYXJhdGlvbiBmb3IgZGF0YSBjb250cm9scyBhbmQgcmVhbCByZXF1ZXN0IGRhdGEuXG5cbiAgICBjb25zdCBkYXRhT2JqZWN0ID0gdGhpcy5mb3JtRGF0YU9iamVjdChmb3JtRGF0YSlcblxuICAgIGlmIChfLmlzRW1wdHkoZGF0YU9iamVjdCkpIHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdCgnTm8gZm9ybURhdGEgdG8gc2VuZCB0byB0aGUgc2VydmVyLicpXG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGpRdWVyeS5hamF4KHtcbiAgICAgICAgdXJsOiB0aGlzLmFqYXhVcmwsXG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICBkYXRhOiBkYXRhT2JqZWN0LFxuICAgICAgICBlcnJvcjogcmVqZWN0LFxuICAgICAgICBzdWNjZXNzOiByZXNvbHZlXG4gICAgICB9KVxuICAgIH0pXG4gIH1cbn1cblxuLyoqXG4gKiBSZXF1ZXN0IEZhY3RvcnlcbiAqXG4gKiBAcGFyYW0gYWpheFVybFxuICogQHBhcmFtIGFjdGlvblxuICogQHJldHVybnMge1JlcXVlc3R9XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBSZXF1ZXN0RmFjdG9yeSAoYWpheFVybCwgYWN0aW9uKVxue1xuICBpZiAoIWFqYXhVcmwgfHwgIWFjdGlvbikge1xuICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBwYXJhbWV0ZXJzIHdoZW4gY29uc3RydWN0IFJlcXVlc3QgaW5zdGFuY2UnKVxuICB9XG5cbiAgbGV0IG9iamVjdCA9IG5ldyBSZXF1ZXN0KGFqYXhVcmwsIGFjdGlvbilcbiAgT2JqZWN0LmZyZWV6ZShvYmplY3QpXG5cbiAgcmV0dXJuIG9iamVjdFxufVxuIiwiLyoqXG4gKiBSZXRyaWV2ZSBDb250ZXh0IGJ5IEVsZW1lbnRcbiAqXG4gKiBAcGFyYW0gZWxlbWVudFxuICogQHJldHVybnMge3N0cmluZ31cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNvbnRleHRCeUVsZW1lbnQgKGVsZW1lbnQpXG57XG4gIHJldHVybiAoJ2NvbnRleHQnIGluIGVsZW1lbnQuZGF0YXNldCA/IGVsZW1lbnQuZGF0YXNldC5jb250ZXh0IDogJycpXG59XG4iLCJpbXBvcnQgeyBjb250ZXh0QnlFbGVtZW50IH0gZnJvbSAnLi9jb250ZXh0J1xuXG5jb25zdCBDQVJUX0JVVFRPTl9TRUxFQ1RPUiA9ICd3b28tcGF5cGFscGx1cy1jaGVja291dC1ub25jZSdcblxuLyoqXG4gKiBDcmVhdGUgYSBGb3JtRGF0YSBvYmplY3QgYnkgdGhlIGNsb3Nlc3QgZm9ybSBvZiB0aGUgZ2l2ZW4gZWxlbWVudFxuICpcbiAqIEBwYXJhbSBlbGVtZW50XG4gKiBAcmV0dXJucyB7Rm9ybURhdGF9XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBmb3JtRGF0YUJ5RWxlbWVudCAoZWxlbWVudClcbntcbiAgY29uc3QgZm9ybSA9IGVsZW1lbnQuY2xvc2VzdCgnZm9ybScpXG5cbiAgaWYgKCFmb3JtKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgJ1VuYWJsZSB0byByZXRyaWV2ZSBmb3JtLiBGb3JtIGVsZW1lbnQgZG9lcyBub3QgZXhpc3RzIG9yIGlzIG5vdCBhIHBhcmVudCBvZiB0aGUgZ2l2ZW4gZWxlbWVudC4nXG4gICAgKVxuICB9XG5cbiAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoZm9ybSlcbiAgZm9ybURhdGEuYXBwZW5kKCdjb250ZXh0JywgY29udGV4dEJ5RWxlbWVudChlbGVtZW50KSlcblxuICByZXR1cm4gZm9ybURhdGFcbn1cblxuLyoqXG4gKiBDcmVhdGUgYSBGb3JtRGF0YSBmb3IgdGhlIENhcnRcbiAqIFdvb0NvbW1lcmNlIG1pbmkgY2FydCBkb2Vzbid0IGhhdmUgYW55IGZvcm0gYXNzb2NpYXRlZCB3aXRoIGl0XG4gKlxuICogQHBhcmFtIGVsZW1lbnRcbiAqIEByZXR1cm5zIHtGb3JtRGF0YX1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGZvcm1EYXRhRm9yQ2FydCAoZWxlbWVudClcbntcbiAgdHJ5IHtcbiAgICBjb25zdCBbbm9uY2VOYW1lLCBub25jZVZhbHVlXSA9IHJldHJpZXZlTm9uY2VGb3JDYXJ0KGVsZW1lbnQpXG4gICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKVxuXG4gICAgZm9ybURhdGEuYXBwZW5kKCdjb250ZXh0JywgY29udGV4dEJ5RWxlbWVudChlbGVtZW50KSlcbiAgICBmb3JtRGF0YS5hcHBlbmQobm9uY2VOYW1lLCBub25jZVZhbHVlKVxuXG4gICAgcmV0dXJuIGZvcm1EYXRhXG4gIH0gY2F0Y2ggKGVycikge1xuICAgIHJldHVybiBuZXcgRm9ybURhdGEoKVxuICB9XG59XG5cbmZ1bmN0aW9uIHJldHJpZXZlTm9uY2VGb3JDYXJ0IChlbGVtZW50KVxue1xuICBjb25zdCBub25jZUVsZW1lbnQgPSBlbGVtZW50LnBhcmVudE5vZGUucXVlcnlTZWxlY3RvcihgLiR7Q0FSVF9CVVRUT05fU0VMRUNUT1J9YClcblxuICBpZiAoIW5vbmNlRWxlbWVudCkge1xuICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IGJ1aWxkIHRoZSBmb3JtIGRhdGEsIG1pc3Npbmcgc2VjdXJpdHkgbm9uY2UuJylcbiAgfVxuXG4gIGNvbnN0IG5vbmNlTmFtZSA9ICgnbm9uY2VuYW1lJyBpbiBub25jZUVsZW1lbnQuZGF0YXNldCkgPyBub25jZUVsZW1lbnQuZGF0YXNldC5ub25jZW5hbWUgOiAnJ1xuICBjb25zdCBub25jZVZhbHVlID0gKCdub25jZXZhbHVlJyBpbiBub25jZUVsZW1lbnQuZGF0YXNldCkgPyBub25jZUVsZW1lbnQuZGF0YXNldC5ub25jZXZhbHVlIDogJydcblxuICBpZiAoIW5vbmNlTmFtZSB8fCAhbm9uY2VWYWx1ZSkge1xuICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IGJ1aWxkIHRoZSBmb3JtIGRhdGEsIG1pc3Npbmcgc2VjdXJpdHkgbm9uY2UuJylcbiAgfVxuXG4gIHJldHVybiBbXG4gICAgbm9uY2VOYW1lLFxuICAgIG5vbmNlVmFsdWVcbiAgXVxufVxuIiwiaW1wb3J0IHsgZm9ybURhdGFCeUVsZW1lbnQsIGZvcm1EYXRhRm9yQ2FydCB9IGZyb20gJy4vZm9ybSdcbmltcG9ydCB7IGNvbnRleHRCeUVsZW1lbnQgfSBmcm9tICcuL2NvbnRleHQnXG5cbmNvbnN0IFNJTkdMRV9QUk9EVUNUX0JVVFRPTiA9ICdwYXlwYWxwbHVzX2Vjc19zaW5nbGVfcHJvZHVjdF9idXR0b24nXG5jb25zdCBDQVJUX0JVVFRPTiA9ICdwYXlwYWxwbHVzX2Vjc19jYXJ0X2J1dHRvbidcblxuY29uc3QgVEFTS19DUkVBVEVfT1JERVIgPSAnY3JlYXRlT3JkZXInXG5jb25zdCBUQVNLX1NUT1JFX1BBWU1FTlRfREFUQSA9ICdzdG9yZVBheW1lbnREYXRhJ1xuXG4vKipcbiAqIENsYXNzIFNtYXJ0IFBheW1lbnQgQnV0dG9uIFJlbmRlcmVyXG4gKlxuICogQHR5cGUge1NtYXJ0UGF5bWVudEJ1dHRvblJlbmRlcmVyfVxuICovXG5jb25zdCBTbWFydFBheW1lbnRCdXR0b25SZW5kZXJlciA9IGNsYXNzIFNtYXJ0UGF5bWVudEJ1dHRvblJlbmRlcmVyXG57XG4gIC8qKlxuICAgKiBDb25zdHJ1Y3RvclxuICAgKlxuICAgKiBAcGFyYW0gYnV0dG9uQ29uZmlndXJhdGlvblxuICAgKiBAcGFyYW0gdmFsaWRDb250ZXh0c1xuICAgKiBAcGFyYW0gcmVxdWVzdFxuICAgKi9cbiAgY29uc3RydWN0b3IgKGJ1dHRvbkNvbmZpZ3VyYXRpb24sIHZhbGlkQ29udGV4dHMsIHJlcXVlc3QpXG4gIHtcbiAgICB0aGlzLmJ1dHRvbkNvbmZpZ3VyYXRpb24gPSBidXR0b25Db25maWd1cmF0aW9uXG4gICAgdGhpcy52YWxpZENvbnRleHRzID0gQXJyYXkuZnJvbSh2YWxpZENvbnRleHRzKVxuICAgIHRoaXMucmVxdWVzdCA9IHJlcXVlc3RcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW5kZXIgYnV0dG9uIGZvciBzaW5nbGUgcHJvZHVjdFxuICAgKi9cbiAgc2luZ2xlUHJvZHVjdEJ1dHRvblJlbmRlciAoKVxuICB7XG4gICAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke1NJTkdMRV9QUk9EVUNUX0JVVFRPTn1gKVxuICAgIGVsZW1lbnQgJiYgdGhpcy5yZW5kZXIoZWxlbWVudClcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW5kZXIgQnV0dG9uIGZvciBDYXJ0XG4gICAqL1xuICBjYXJ0QnV0dG9uUmVuZGVyICgpXG4gIHtcbiAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgIyR7Q0FSVF9CVVRUT059YClcbiAgICBlbGVtZW50ICYmIHRoaXMucmVuZGVyKGVsZW1lbnQpXG4gIH1cblxuICAvKipcbiAgICogUmVuZGVyIEJ1dHRvbiBmb3IgdGhlIEdpdmVuIEVsZW1lbnRcbiAgICpcbiAgICogQHBhcmFtIGVsZW1lbnRcbiAgICogQHJldHVybnMgeyp9XG4gICAqL1xuICAvLyBUT0RPIE1ha2UgaXQgcHJpdmF0ZVxuICByZW5kZXIgKGVsZW1lbnQpXG4gIHtcbiAgICBpZiAoXy5pc1VuZGVmaW5lZChwYXlwYWwpKSB7XG4gICAgICByZXR1cm5cbiAgICB9XG5cbiAgICBwYXlwYWwuQnV0dG9uLnJlbmRlcih7XG4gICAgICAuLi50aGlzLmJ1dHRvbkNvbmZpZ3VyYXRpb24sXG5cbiAgICAgIC8qKlxuICAgICAgICogRG8gUGF5bWVudFxuICAgICAgICpcbiAgICAgICAqIEByZXR1cm5zIHsqfVxuICAgICAgICovXG4gICAgICBwYXltZW50OiAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGZvcm1EYXRhID0gdGhpcy5mb3JtRGF0YUJ5RWxlbWVudChlbGVtZW50KVxuICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ3Rhc2snLCBUQVNLX0NSRUFURV9PUkRFUilcblxuICAgICAgICByZXR1cm4gdGhpcy5yZXF1ZXN0XG4gICAgICAgICAgLnN1Ym1pdChmb3JtRGF0YSlcbiAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgICAgICBpZiAoISgnZGF0YScgaW4gcmVzcG9uc2UpKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUud2FybignVW5hYmxlIHRvIHByb2Nlc3MgdGhlIHBheW1lbnQsIHNlcnZlciBkaWQgbm90IHJlc3BvbnNlIHdpdGggdmFsaWQgZGF0YScpXG4gICAgICAgICAgICAgIHJldHVyblxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgIC8vIFRPRE8gRG8gc29tZXRoaW5nIHRvIGluZm9ybSB1c2VyIGFib3V0IHRoZSBwcm9ibGVtIGFuZCBjbG9zZSB0aGUgZmxvdy5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3Qgb3JkZXJJZCA9ICdvcmRlcklEJyBpbiByZXNwb25zZS5kYXRhID8gcmVzcG9uc2UuZGF0YS5vcmRlcklEIDogJydcbiAgICAgICAgICAgIGlmICghb3JkZXJJZCkge1xuICAgICAgICAgICAgICAvLyBUT0RPIERvIHNvbWV0aGluZyB0byBpbmZvcm0gdXNlciBhYm91dCB0aGUgcHJvYmxlbSBhbmQgY2xvc2UgdGhlIGZsb3cuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBvcmRlcklkXG4gICAgICAgICAgfSlcbiAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICAgICAgY29uc3QgdGV4dFN0YXR1cyA9ICd0ZXh0U3RhdHVzJyBpbiBlcnJvciA/IGVycm9yLnRleHRTdGF0dXMgOiAnVW5rbm93biBFcnJvciBkdXJpbmcgcGF5bWVudCdcbiAgICAgICAgICAgIGNvbnNvbGUud2Fybih0ZXh0U3RhdHVzKVxuICAgICAgICAgIH0pXG4gICAgICB9LFxuXG4gICAgICAvKipcbiAgICAgICAqIEV4ZWN1dGUgQXV0aG9yaXphdGlvblxuICAgICAgICpcbiAgICAgICAqIEBwYXJhbSBkYXRhXG4gICAgICAgKiBAcGFyYW0gYWN0aW9uc1xuICAgICAgICogQHJldHVybnMgeyp9XG4gICAgICAgKi9cbiAgICAgIG9uQXV0aG9yaXplOiAoZGF0YSwgYWN0aW9ucykgPT4ge1xuICAgICAgICAvLyBUT0RPIEVuc3VyZSByZXR1cm5fdXJsIGV4aXN0cy5cbiAgICAgICAgY29uc3QgZm9ybURhdGEgPSB0aGlzLmZvcm1EYXRhQnlFbGVtZW50KGVsZW1lbnQpXG5cbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCd0YXNrJywgVEFTS19TVE9SRV9QQVlNRU5UX0RBVEEpXG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnb3JkZXJJRCcsIGRhdGEub3JkZXJJRClcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdwYXllcklEJywgZGF0YS5wYXllcklEKVxuICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ3BheW1lbnRJRCcsIGRhdGEucGF5bWVudElEKVxuICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ3BheW1lbnRUb2tlbicsIGRhdGEucGF5bWVudFRva2VuKVxuXG4gICAgICAgIHJldHVybiB0aGlzLnJlcXVlc3RcbiAgICAgICAgICAuc3VibWl0KGZvcm1EYXRhKVxuICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgY29uc3QgcmV0dXJuVXJsID0gJ3JldHVyblVybCcgaW4gZGF0YSA/IGRhdGEucmV0dXJuVXJsIDogJydcbiAgICAgICAgICAgICAgcmV0dXJuVXJsICYmIGFjdGlvbnMucmVkaXJlY3QobnVsbCwgcmV0dXJuVXJsKVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBUT0RPIFNob3cgYWxlcnQgdG8gdGhlIHVzZXJcbiAgICAgICAgICB9KVxuICAgICAgfSxcblxuICAgICAgLyoqXG4gICAgICAgKiBQZXJmb3JtIEFjdGlvbiB3aGVuIGEgUGF5bWVudCBnZXQgQ2FuY2VsbGVkXG4gICAgICAgKlxuICAgICAgICogQHBhcmFtIGRhdGFcbiAgICAgICAqIEBwYXJhbSBhY3Rpb25zXG4gICAgICAgKi9cbiAgICAgIG9uQ2FuY2VsOiAoZGF0YSwgYWN0aW9ucykgPT4ge1xuICAgICAgICBhY3Rpb25zLmNsb3NlKClcbiAgICAgICAgY29uc3QgY2FuY2VsVXJsID0gJ2NhbmNlbFVybCcgaW4gZGF0YSA/IGRhdGEuY2FuY2VsVXJsIDogJydcbiAgICAgICAgY2FuY2VsVXJsICYmIGFjdGlvbnMucmVkaXJlY3QobnVsbCwgY2FuY2VsVXJsKVxuICAgICAgfSxcblxuICAgICAgb25FcnJvcjogKGRhdGEsIGFjdGlvbnMpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ09OIEVSUk9SJywgZGF0YSwgYWN0aW9ucylcbiAgICAgICAgLy8gVE9ETyBSZWRpcmVjdCB0byBjYXJ0IGFuZCBzaG93IGN1c3RvbWl6YWJsZSBub3RpY2Ugd2l0aCBtZXNzYWdlLlxuICAgICAgfVxuXG4gICAgfSwgZWxlbWVudClcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZSBjb250ZXh0IGZvciBGb3JtRGF0YSBpbnN0YW5jZSBieSB0aGUgR2l2ZW4gRWxlbWVudFxuICAgKlxuICAgKiBAcGFyYW0gZWxlbWVudFxuICAgKiBAcmV0dXJucyB7Rm9ybURhdGF9XG4gICAqL1xuICAvLyBUT0RPIE1ha2UgaXQgcHJpdmF0ZSBpZiBub3QgcG9zc2libGUgbW92ZSBpdCBhcyBjbG9zdXJlIHdpdGhpbiB0aGUgcmVuZGVyIGZ1bmN0aW9uLlxuICBmb3JtRGF0YUJ5RWxlbWVudCAoZWxlbWVudClcbiAge1xuICAgIGxldCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpXG4gICAgY29uc3QgY29udGV4dCA9IGNvbnRleHRCeUVsZW1lbnQoZWxlbWVudClcblxuICAgIGlmICghdGhpcy52YWxpZENvbnRleHRzLmluY2x1ZGVzKGNvbnRleHQpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICdJbnZhbGlkIGNvbnRleHQgd2hlbiB0cnkgdG8gcmV0cmlldmUgdGhlIGZvcm0gZGF0YSBkdXJpbmcgZXhwcmVzcyBjaGVja291dCByZXF1ZXN0LidcbiAgICAgIClcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgc3dpdGNoIChjb250ZXh0KSB7XG4gICAgICAgIGNhc2UgJ2NhcnQnOlxuICAgICAgICAgIGZvcm1EYXRhID0gZm9ybURhdGFGb3JDYXJ0KGVsZW1lbnQpXG4gICAgICAgICAgYnJlYWtcbiAgICAgICAgY2FzZSAncHJvZHVjdCc6XG4gICAgICAgICAgZm9ybURhdGEgPSBmb3JtRGF0YUJ5RWxlbWVudChlbGVtZW50KVxuICAgICAgICAgIGJyZWFrXG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZvcm1EYXRhXG4gIH1cbn1cblxuLyoqXG4gKiBTbWFydCBQYXltZW50IEJ1dHRvbiBSZW5kZXJlciBGYWN0b3J5XG4gKlxuICogQHBhcmFtIGJ1dHRvbkNvbmZpZ3VyYXRpb25cbiAqIEBwYXJhbSB2YWxpZENvbnRleHRzXG4gKiBAcGFyYW0gcmVxdWVzdFxuICogQHJldHVybnMge1NtYXJ0UGF5bWVudEJ1dHRvblJlbmRlcmVyfVxuICogQGNvbnN0cnVjdG9yXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBTbWFydFBheW1lbnRCdXR0b25SZW5kZXJlckZhY3RvcnkgKGJ1dHRvbkNvbmZpZ3VyYXRpb24sIHZhbGlkQ29udGV4dHMsIHJlcXVlc3QpXG57XG4gIGNvbnN0IG9iamVjdCA9IG5ldyBTbWFydFBheW1lbnRCdXR0b25SZW5kZXJlcihidXR0b25Db25maWd1cmF0aW9uLCB2YWxpZENvbnRleHRzLCByZXF1ZXN0KVxuXG4gIE9iamVjdC5mcmVlemUob2JqZWN0KVxuXG4gIHJldHVybiBvYmplY3Rcbn1cbiIsImltcG9ydCB7IFJlcXVlc3RGYWN0b3J5IH0gZnJvbSAnLi9leHByZXNzQ2hlY2tvdXQvUmVxdWVzdCdcbmltcG9ydCB7IFNtYXJ0UGF5bWVudEJ1dHRvblJlbmRlcmVyRmFjdG9yeSB9IGZyb20gJy4vZXhwcmVzc0NoZWNrb3V0L3NtYXJ0UGF5bWVudEJ1dHRvbidcblxuKGZ1bmN0aW9uIChqUXVlcnksIF8sIGV4cHJlc3NDaGVja291dERhdGEpIHtcbiAgLyoqXG4gICAqIEVuc3VyZSB0aGUgR2xvYmFsIEV4cHJlc3MgQ2hlY2tvdXQgaXMgYSBWYWxpZCBWYWx1ZVxuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAgICovXG4gIGZ1bmN0aW9uIGlzVmFsaWRFeHByZXNzQ2hlY2tvdXREYXRhICgpXG4gIHtcbiAgICByZXR1cm4gIV8uaXNVbmRlZmluZWQoZXhwcmVzc0NoZWNrb3V0RGF0YSkgJiYgIV8uaXNFbXB0eShleHByZXNzQ2hlY2tvdXREYXRhKVxuICB9XG5cbiAgLyoqXG4gICAqIEJvb3RzdHJhcCBFeHByZXNzIGNoZWNrb3V0XG4gICAqIEByZXR1cm5zIHZvaWRcbiAgICovXG4gIGZ1bmN0aW9uIGJvb3RzdHJhcEV4cHJlc3NDaGVja291dCAoKVxuICB7XG4gICAgaWYgKCFpc1ZhbGlkRXhwcmVzc0NoZWNrb3V0RGF0YSgpKSB7XG4gICAgICByZXR1cm5cbiAgICB9XG5cbiAgICBjb25zdCByZXF1ZXN0RGF0YSA9IGV4cHJlc3NDaGVja291dERhdGEucmVxdWVzdFxuICAgIGlmICghXy5pc09iamVjdChyZXF1ZXN0RGF0YSkpIHtcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIGNvbnN0IHZhbGlkQ29udGV4dHMgPSBleHByZXNzQ2hlY2tvdXREYXRhLnZhbGlkQ29udGV4dHNcbiAgICBpZiAoIV8uaXNBcnJheSh2YWxpZENvbnRleHRzKSkge1xuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgY29uc3QgcmVxdWVzdCA9IFJlcXVlc3RGYWN0b3J5KHJlcXVlc3REYXRhLmFqYXhVcmwsIHJlcXVlc3REYXRhLmFjdGlvbilcbiAgICBjb25zdCBzbWFydFBheW1lbnRCdXR0b24gPSBTbWFydFBheW1lbnRCdXR0b25SZW5kZXJlckZhY3RvcnkoXG4gICAgICBleHByZXNzQ2hlY2tvdXREYXRhLFxuICAgICAgdmFsaWRDb250ZXh0cyxcbiAgICAgIHJlcXVlc3RcbiAgICApXG5cbiAgICBzbWFydFBheW1lbnRCdXR0b24uc2luZ2xlUHJvZHVjdEJ1dHRvblJlbmRlcigpXG4gICAgc21hcnRQYXltZW50QnV0dG9uLmNhcnRCdXR0b25SZW5kZXIoKVxuICAgIGpRdWVyeShkb2N1bWVudC5ib2R5KS5vbignd2NfZnJhZ21lbnRzX3JlZnJlc2hlZCByZW1vdmVkX2Zyb21fY2FydCBhZGRlZF90b19jYXJ0JywgKCkgPT4ge1xuICAgICAgc21hcnRQYXltZW50QnV0dG9uLmNhcnRCdXR0b25SZW5kZXIoKVxuICAgIH0pXG4gIH1cblxuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsICgpID0+IHtcbiAgICBib290c3RyYXBFeHByZXNzQ2hlY2tvdXQoKVxuICB9KVxufSkoalF1ZXJ5LCB3aW5kb3cuXywgd2luZG93Lndvb1BheVBhbFBsdXNFeHByZXNzQ2hlY2tvdXQpXG4iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///1\n")}]);
>>>>>>> Improve logging for express checkout
=======
!function(n){var t={};function e(I){if(t[I])return t[I].exports;var c=t[I]={i:I,l:!1,exports:{}};return n[I].call(c.exports,c,c.exports,e),c.l=!0,c.exports}e.m=n,e.c=t,e.d=function(n,t,I){e.o(n,t)||Object.defineProperty(n,t,{enumerable:!0,get:I})},e.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},e.t=function(n,t){if(1&t&&(n=e(n)),8&t)return n;if(4&t&&"object"==typeof n&&n&&n.__esModule)return n;var I=Object.create(null);if(e.r(I),Object.defineProperty(I,"default",{enumerable:!0,value:n}),2&t&&"string"!=typeof n)for(var c in n)e.d(I,c,function(t){return n[t]}.bind(null,c));return I},e.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(t,"a",t),t},e.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},e.p="",e(e.s=1)}([,function(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n\n// CONCATENATED MODULE: ./resources/js/expressCheckout/Request.js\n/**\n * Class Request\n *\n * @type {Request}\n */\nconst Request = class Request\n{\n  // TODO Make the fields private if possible.\n  constructor (ajaxUrl, action)\n  {\n    this.ajaxUrl = ajaxUrl\n    this.action = action\n  }\n\n  formDataObject (formData)\n  {\n    const formDataEntries = [...formData.entries(), ['action', this.action]]\n    const dataObject = formDataEntries.reduce((obj, [key, value]) => {\n      obj[key] = value\n      return obj\n    }, {})\n\n    return dataObject\n  }\n\n  submit (formData)\n  {\n    // TODO Extract specific data such as: action, nonce, task, context and\n    //      put the rest within a specific object.\n    //      Make a separation for data controls and real request data.\n\n    const dataObject = this.formDataObject(formData)\n\n    if (_.isEmpty(dataObject)) {\n      return Promise.reject('No formData to send to the server.')\n    }\n\n    return new Promise((resolve, reject) => {\n      jQuery.ajax({\n        url: this.ajaxUrl,\n        method: 'POST',\n        data: dataObject,\n        error: reject,\n        success: resolve\n      })\n    })\n  }\n}\n\n/**\n * Request Factory\n *\n * @param ajaxUrl\n * @param action\n * @returns {Request}\n */\nfunction RequestFactory (ajaxUrl, action)\n{\n  if (!ajaxUrl || !action) {\n    throw new Error('Invalid parameters when construct Request instance')\n  }\n\n  let object = new Request(ajaxUrl, action)\n  Object.freeze(object)\n\n  return object\n}\n\n// CONCATENATED MODULE: ./resources/js/expressCheckout/context.js\n/**\n * Retrieve Context by Element\n *\n * @param element\n * @returns {string}\n */\nfunction contextByElement (element)\n{\n  return ('context' in element.dataset ? element.dataset.context : '')\n}\n\n// CONCATENATED MODULE: ./resources/js/expressCheckout/form.js\n\n\nconst CART_BUTTON_SELECTOR = 'woo-paypalplus-checkout-nonce'\n\n/**\n * Create a FormData object by the closest form of the given element\n *\n * @param element\n * @returns {FormData}\n */\nfunction formDataByElement (element)\n{\n  const form = element.closest('form')\n\n  if (!form) {\n    throw new Error(\n      'Unable to retrieve form. Form element does not exists or is not a parent of the given element.'\n    )\n  }\n\n  const formData = new FormData(form)\n  formData.append('context', contextByElement(element))\n\n  return formData\n}\n\n/**\n * Create a FormData for the Cart\n * WooCommerce mini cart doesn't have any form associated with it\n *\n * @param element\n * @returns {FormData}\n */\nfunction formDataForCart (element)\n{\n  try {\n    const [nonceName, nonceValue] = retrieveNonceForCart(element)\n    const formData = new FormData()\n\n    formData.append('context', contextByElement(element))\n    formData.append(nonceName, nonceValue)\n\n    return formData\n  } catch (err) {\n    return new FormData()\n  }\n}\n\nfunction retrieveNonceForCart (element)\n{\n  const nonceElement = element.parentNode.querySelector(`.${CART_BUTTON_SELECTOR}`)\n\n  if (!nonceElement) {\n    throw new Error('Cannot build the form data, missing security nonce.')\n  }\n\n  const nonceName = ('noncename' in nonceElement.dataset) ? nonceElement.dataset.noncename : ''\n  const nonceValue = ('noncevalue' in nonceElement.dataset) ? nonceElement.dataset.noncevalue : ''\n\n  if (!nonceName || !nonceValue) {\n    throw new Error('Cannot build the form data, missing security nonce.')\n  }\n\n  return [\n    nonceName,\n    nonceValue\n  ]\n}\n\n// CONCATENATED MODULE: ./resources/js/expressCheckout/smartPaymentButton.js\n\n\n\nconst SINGLE_PRODUCT_BUTTON = 'paypalplus_ecs_single_product_button'\nconst CART_BUTTON = 'paypalplus_ecs_cart_button'\n\nconst TASK_CREATE_ORDER = 'createOrder'\nconst TASK_STORE_PAYMENT_DATA = 'storePaymentData'\n\n/**\n * Class Smart Payment Button Renderer\n *\n * @type {SmartPaymentButtonRenderer}\n */\nconst smartPaymentButton_SmartPaymentButtonRenderer = class SmartPaymentButtonRenderer\n{\n  /**\n   * Constructor\n   *\n   * @param buttonConfiguration\n   * @param validContexts\n   * @param request\n   */\n  constructor (buttonConfiguration, validContexts, request)\n  {\n    this.buttonConfiguration = buttonConfiguration\n    this.validContexts = Array.from(validContexts)\n    this.request = request\n  }\n\n  /**\n   * Render button for single product\n   */\n  singleProductButtonRender ()\n  {\n    const element = document.querySelector(`#${SINGLE_PRODUCT_BUTTON}`)\n    element && this.render(element)\n  }\n\n  /**\n   * Render Button for Cart\n   */\n  cartButtonRender ()\n  {\n    const element = document.querySelector(`#${CART_BUTTON}`)\n    element && this.render(element)\n  }\n\n  /**\n   * Render Button for the Given Element\n   *\n   * @param element\n   * @returns {*}\n   */\n  // TODO Make it private\n  render (element)\n  {\n    if (_.isUndefined(paypal)) {\n      return\n    }\n\n    paypal.Button.render({\n      ...this.buttonConfiguration,\n\n      /**\n       * Do Payment\n       *\n       * @returns {*}\n       */\n      payment: () => {\n        const formData = this.formDataByElement(element)\n        formData.append('task', TASK_CREATE_ORDER)\n\n        return this.request\n          .submit(formData)\n          .then(response => {\n            if (!('data' in response)) {\n              console.warn('Unable to process the payment, server did not response with valid data')\n              try {\n                window.location = this.buttonConfiguration.redirect_urls.cancel_url\n              } catch (e) {\n                return\n              }\n            }\n\n            if (!response.success) {\n              try {\n                window.location = this.buttonConfiguration.redirect_urls.cancel_url\n              } catch (e) {\n                return\n              }\n            }\n\n            const orderId = 'orderID' in response.data ? response.data.orderID : ''\n\n            if (!orderId) {\n              try {\n                window.location = this.buttonConfiguration.redirect_urls.cancel_url\n              } catch (e) {\n                return\n              }\n            }\n\n            return orderId\n          })\n          .catch(error => {\n            const textStatus = 'textStatus' in error ? error.textStatus : 'Unknown Error during payment'\n            console.warn(textStatus)\n          })\n      },\n\n      /**\n       * Execute Authorization\n       *\n       * @param data\n       * @param actions\n       * @returns {*}\n       */\n      onAuthorize: (data, actions) => {\n        // TODO Ensure return_url exists.\n        const formData = this.formDataByElement(element)\n\n        formData.append('task', TASK_STORE_PAYMENT_DATA)\n        formData.append('orderID', data.orderID)\n        formData.append('payerID', data.payerID)\n        formData.append('paymentID', data.paymentID)\n        formData.append('paymentToken', data.paymentToken)\n\n        return this.request\n          .submit(formData)\n          .then((response) => {\n            if (!response.success) {\n              try {\n                window.location = this.buttonConfiguration.redirect_urls.cancel_url\n              } catch (e) {\n                return\n              }\n            }\n\n            const returnUrl = 'returnUrl' in data ? data.returnUrl : ''\n            returnUrl && actions.redirect(null, returnUrl)\n          })\n      },\n\n      /**\n       * Perform Action when a Payment get Cancelled\n       *\n       * @param data\n       * @param actions\n       */\n      onCancel: (data, actions) => {\n        actions.close()\n        const cancelUrl = 'cancelUrl' in data ? data.cancelUrl : ''\n        cancelUrl && actions.redirect(null, cancelUrl)\n      },\n\n      onError: (data, actions) => {\n        console.log('ON ERROR', data, actions)\n        // TODO Redirect to cart and show customizable notice with message.\n      }\n\n    }, element)\n  }\n\n  /**\n   * Retrieve context for FormData instance by the Given Element\n   *\n   * @param element\n   * @returns {FormData}\n   */\n  // TODO Make it private if not possible move it as closure within the render function.\n  formDataByElement (element)\n  {\n    let formData = new FormData()\n    const context = contextByElement(element)\n\n    if (!this.validContexts.includes(context)) {\n      throw new Error(\n        'Invalid context when try to retrieve the form data during express checkout request.'\n      )\n    }\n\n    try {\n      switch (context) {\n        case 'cart':\n          formData = formDataForCart(element)\n          break\n        case 'product':\n          formData = formDataByElement(element)\n          break\n      }\n    } catch (err) {\n    }\n\n    return formData\n  }\n}\n\n/**\n * Smart Payment Button Renderer Factory\n *\n * @param buttonConfiguration\n * @param validContexts\n * @param request\n * @returns {SmartPaymentButtonRenderer}\n * @constructor\n */\nfunction SmartPaymentButtonRendererFactory (buttonConfiguration, validContexts, request)\n{\n  const object = new smartPaymentButton_SmartPaymentButtonRenderer(buttonConfiguration, validContexts, request)\n\n  Object.freeze(object)\n\n  return object\n}\n\n// CONCATENATED MODULE: ./resources/js/expressCheckout.js\n\n\n\n(function (jQuery, _, expressCheckoutData) {\n  /**\n   * Ensure the Global Express Checkout is a Valid Value\n   * @returns {boolean}\n   */\n  function isValidExpressCheckoutData ()\n  {\n    return !_.isUndefined(expressCheckoutData) && !_.isEmpty(expressCheckoutData)\n  }\n\n  /**\n   * Bootstrap Express checkout\n   * @returns void\n   */\n  function bootstrapExpressCheckout ()\n  {\n    if (!isValidExpressCheckoutData()) {\n      return\n    }\n\n    const requestData = expressCheckoutData.request\n    if (!_.isObject(requestData)) {\n      return\n    }\n\n    const validContexts = expressCheckoutData.validContexts\n    if (!_.isArray(validContexts)) {\n      return\n    }\n\n    const request = RequestFactory(requestData.ajaxUrl, requestData.action)\n    const smartPaymentButton = SmartPaymentButtonRendererFactory(\n      expressCheckoutData,\n      validContexts,\n      request\n    )\n\n    smartPaymentButton.singleProductButtonRender()\n    smartPaymentButton.cartButtonRender()\n    jQuery(document.body).on('wc_fragments_refreshed removed_from_cart added_to_cart', () => {\n      smartPaymentButton.cartButtonRender()\n    })\n  }\n\n  window.addEventListener('load', () => {\n    bootstrapExpressCheckout()\n  })\n})(jQuery, window._, window.wooPayPalPlusExpressCheckout)\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9yZXNvdXJjZXMvanMvZXhwcmVzc0NoZWNrb3V0L1JlcXVlc3QuanM/OGQ1ZiIsIndlYnBhY2s6Ly8vLi9yZXNvdXJjZXMvanMvZXhwcmVzc0NoZWNrb3V0L2NvbnRleHQuanM/NjhkMyIsIndlYnBhY2s6Ly8vLi9yZXNvdXJjZXMvanMvZXhwcmVzc0NoZWNrb3V0L2Zvcm0uanM/ZWE1ZCIsIndlYnBhY2s6Ly8vLi9yZXNvdXJjZXMvanMvZXhwcmVzc0NoZWNrb3V0L3NtYXJ0UGF5bWVudEJ1dHRvbi5qcz9mM2IyIiwid2VicGFjazovLy8uL3Jlc291cmNlcy9qcy9leHByZXNzQ2hlY2tvdXQuanM/ZGNjMyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUssSUFBSTs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7O0FDbEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ087QUFDUDtBQUNBO0FBQ0E7OztBQ1Q0Qzs7QUFFNUM7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDTztBQUNQO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDZCQUE2QixnQkFBZ0I7O0FBRTdDO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsK0JBQStCLGdCQUFnQjtBQUMvQzs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLDREQUE0RCxxQkFBcUI7O0FBRWpGO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUNuRTJEO0FBQ2Y7O0FBRTVDO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQSxNQUFNLDZDQUEwQjtBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBK0Msc0JBQXNCO0FBQ3JFO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtDQUErQyxZQUFZO0FBQzNEO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUI7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1gsT0FBTzs7QUFFUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsV0FBVztBQUNYLE9BQU87O0FBRVA7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPOztBQUVQO0FBQ0E7QUFDQTtBQUNBOztBQUVBLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGdCQUFnQjs7QUFFcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUIsZUFBZTtBQUNwQztBQUNBO0FBQ0EscUJBQXFCLGlCQUFpQjtBQUN0QztBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNPO0FBQ1A7QUFDQSxxQkFBcUIsNkNBQTBCOztBQUUvQzs7QUFFQTtBQUNBOzs7QUN0TjBEO0FBQzhCOztBQUV4RjtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsb0JBQW9CLGNBQWM7QUFDbEMsK0JBQStCLGlDQUFpQztBQUNoRTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNILENBQUMiLCJmaWxlIjoiMS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ2xhc3MgUmVxdWVzdFxuICpcbiAqIEB0eXBlIHtSZXF1ZXN0fVxuICovXG5jb25zdCBSZXF1ZXN0ID0gY2xhc3MgUmVxdWVzdFxue1xuICAvLyBUT0RPIE1ha2UgdGhlIGZpZWxkcyBwcml2YXRlIGlmIHBvc3NpYmxlLlxuICBjb25zdHJ1Y3RvciAoYWpheFVybCwgYWN0aW9uKVxuICB7XG4gICAgdGhpcy5hamF4VXJsID0gYWpheFVybFxuICAgIHRoaXMuYWN0aW9uID0gYWN0aW9uXG4gIH1cblxuICBmb3JtRGF0YU9iamVjdCAoZm9ybURhdGEpXG4gIHtcbiAgICBjb25zdCBmb3JtRGF0YUVudHJpZXMgPSBbLi4uZm9ybURhdGEuZW50cmllcygpLCBbJ2FjdGlvbicsIHRoaXMuYWN0aW9uXV1cbiAgICBjb25zdCBkYXRhT2JqZWN0ID0gZm9ybURhdGFFbnRyaWVzLnJlZHVjZSgob2JqLCBba2V5LCB2YWx1ZV0pID0+IHtcbiAgICAgIG9ialtrZXldID0gdmFsdWVcbiAgICAgIHJldHVybiBvYmpcbiAgICB9LCB7fSlcblxuICAgIHJldHVybiBkYXRhT2JqZWN0XG4gIH1cblxuICBzdWJtaXQgKGZvcm1EYXRhKVxuICB7XG4gICAgLy8gVE9ETyBFeHRyYWN0IHNwZWNpZmljIGRhdGEgc3VjaCBhczogYWN0aW9uLCBub25jZSwgdGFzaywgY29udGV4dCBhbmRcbiAgICAvLyAgICAgIHB1dCB0aGUgcmVzdCB3aXRoaW4gYSBzcGVjaWZpYyBvYmplY3QuXG4gICAgLy8gICAgICBNYWtlIGEgc2VwYXJhdGlvbiBmb3IgZGF0YSBjb250cm9scyBhbmQgcmVhbCByZXF1ZXN0IGRhdGEuXG5cbiAgICBjb25zdCBkYXRhT2JqZWN0ID0gdGhpcy5mb3JtRGF0YU9iamVjdChmb3JtRGF0YSlcblxuICAgIGlmIChfLmlzRW1wdHkoZGF0YU9iamVjdCkpIHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdCgnTm8gZm9ybURhdGEgdG8gc2VuZCB0byB0aGUgc2VydmVyLicpXG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGpRdWVyeS5hamF4KHtcbiAgICAgICAgdXJsOiB0aGlzLmFqYXhVcmwsXG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICBkYXRhOiBkYXRhT2JqZWN0LFxuICAgICAgICBlcnJvcjogcmVqZWN0LFxuICAgICAgICBzdWNjZXNzOiByZXNvbHZlXG4gICAgICB9KVxuICAgIH0pXG4gIH1cbn1cblxuLyoqXG4gKiBSZXF1ZXN0IEZhY3RvcnlcbiAqXG4gKiBAcGFyYW0gYWpheFVybFxuICogQHBhcmFtIGFjdGlvblxuICogQHJldHVybnMge1JlcXVlc3R9XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBSZXF1ZXN0RmFjdG9yeSAoYWpheFVybCwgYWN0aW9uKVxue1xuICBpZiAoIWFqYXhVcmwgfHwgIWFjdGlvbikge1xuICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBwYXJhbWV0ZXJzIHdoZW4gY29uc3RydWN0IFJlcXVlc3QgaW5zdGFuY2UnKVxuICB9XG5cbiAgbGV0IG9iamVjdCA9IG5ldyBSZXF1ZXN0KGFqYXhVcmwsIGFjdGlvbilcbiAgT2JqZWN0LmZyZWV6ZShvYmplY3QpXG5cbiAgcmV0dXJuIG9iamVjdFxufVxuIiwiLyoqXG4gKiBSZXRyaWV2ZSBDb250ZXh0IGJ5IEVsZW1lbnRcbiAqXG4gKiBAcGFyYW0gZWxlbWVudFxuICogQHJldHVybnMge3N0cmluZ31cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNvbnRleHRCeUVsZW1lbnQgKGVsZW1lbnQpXG57XG4gIHJldHVybiAoJ2NvbnRleHQnIGluIGVsZW1lbnQuZGF0YXNldCA/IGVsZW1lbnQuZGF0YXNldC5jb250ZXh0IDogJycpXG59XG4iLCJpbXBvcnQgeyBjb250ZXh0QnlFbGVtZW50IH0gZnJvbSAnLi9jb250ZXh0J1xuXG5jb25zdCBDQVJUX0JVVFRPTl9TRUxFQ1RPUiA9ICd3b28tcGF5cGFscGx1cy1jaGVja291dC1ub25jZSdcblxuLyoqXG4gKiBDcmVhdGUgYSBGb3JtRGF0YSBvYmplY3QgYnkgdGhlIGNsb3Nlc3QgZm9ybSBvZiB0aGUgZ2l2ZW4gZWxlbWVudFxuICpcbiAqIEBwYXJhbSBlbGVtZW50XG4gKiBAcmV0dXJucyB7Rm9ybURhdGF9XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBmb3JtRGF0YUJ5RWxlbWVudCAoZWxlbWVudClcbntcbiAgY29uc3QgZm9ybSA9IGVsZW1lbnQuY2xvc2VzdCgnZm9ybScpXG5cbiAgaWYgKCFmb3JtKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgJ1VuYWJsZSB0byByZXRyaWV2ZSBmb3JtLiBGb3JtIGVsZW1lbnQgZG9lcyBub3QgZXhpc3RzIG9yIGlzIG5vdCBhIHBhcmVudCBvZiB0aGUgZ2l2ZW4gZWxlbWVudC4nXG4gICAgKVxuICB9XG5cbiAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoZm9ybSlcbiAgZm9ybURhdGEuYXBwZW5kKCdjb250ZXh0JywgY29udGV4dEJ5RWxlbWVudChlbGVtZW50KSlcblxuICByZXR1cm4gZm9ybURhdGFcbn1cblxuLyoqXG4gKiBDcmVhdGUgYSBGb3JtRGF0YSBmb3IgdGhlIENhcnRcbiAqIFdvb0NvbW1lcmNlIG1pbmkgY2FydCBkb2Vzbid0IGhhdmUgYW55IGZvcm0gYXNzb2NpYXRlZCB3aXRoIGl0XG4gKlxuICogQHBhcmFtIGVsZW1lbnRcbiAqIEByZXR1cm5zIHtGb3JtRGF0YX1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGZvcm1EYXRhRm9yQ2FydCAoZWxlbWVudClcbntcbiAgdHJ5IHtcbiAgICBjb25zdCBbbm9uY2VOYW1lLCBub25jZVZhbHVlXSA9IHJldHJpZXZlTm9uY2VGb3JDYXJ0KGVsZW1lbnQpXG4gICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKVxuXG4gICAgZm9ybURhdGEuYXBwZW5kKCdjb250ZXh0JywgY29udGV4dEJ5RWxlbWVudChlbGVtZW50KSlcbiAgICBmb3JtRGF0YS5hcHBlbmQobm9uY2VOYW1lLCBub25jZVZhbHVlKVxuXG4gICAgcmV0dXJuIGZvcm1EYXRhXG4gIH0gY2F0Y2ggKGVycikge1xuICAgIHJldHVybiBuZXcgRm9ybURhdGEoKVxuICB9XG59XG5cbmZ1bmN0aW9uIHJldHJpZXZlTm9uY2VGb3JDYXJ0IChlbGVtZW50KVxue1xuICBjb25zdCBub25jZUVsZW1lbnQgPSBlbGVtZW50LnBhcmVudE5vZGUucXVlcnlTZWxlY3RvcihgLiR7Q0FSVF9CVVRUT05fU0VMRUNUT1J9YClcblxuICBpZiAoIW5vbmNlRWxlbWVudCkge1xuICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IGJ1aWxkIHRoZSBmb3JtIGRhdGEsIG1pc3Npbmcgc2VjdXJpdHkgbm9uY2UuJylcbiAgfVxuXG4gIGNvbnN0IG5vbmNlTmFtZSA9ICgnbm9uY2VuYW1lJyBpbiBub25jZUVsZW1lbnQuZGF0YXNldCkgPyBub25jZUVsZW1lbnQuZGF0YXNldC5ub25jZW5hbWUgOiAnJ1xuICBjb25zdCBub25jZVZhbHVlID0gKCdub25jZXZhbHVlJyBpbiBub25jZUVsZW1lbnQuZGF0YXNldCkgPyBub25jZUVsZW1lbnQuZGF0YXNldC5ub25jZXZhbHVlIDogJydcblxuICBpZiAoIW5vbmNlTmFtZSB8fCAhbm9uY2VWYWx1ZSkge1xuICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IGJ1aWxkIHRoZSBmb3JtIGRhdGEsIG1pc3Npbmcgc2VjdXJpdHkgbm9uY2UuJylcbiAgfVxuXG4gIHJldHVybiBbXG4gICAgbm9uY2VOYW1lLFxuICAgIG5vbmNlVmFsdWVcbiAgXVxufVxuIiwiaW1wb3J0IHsgZm9ybURhdGFCeUVsZW1lbnQsIGZvcm1EYXRhRm9yQ2FydCB9IGZyb20gJy4vZm9ybSdcbmltcG9ydCB7IGNvbnRleHRCeUVsZW1lbnQgfSBmcm9tICcuL2NvbnRleHQnXG5cbmNvbnN0IFNJTkdMRV9QUk9EVUNUX0JVVFRPTiA9ICdwYXlwYWxwbHVzX2Vjc19zaW5nbGVfcHJvZHVjdF9idXR0b24nXG5jb25zdCBDQVJUX0JVVFRPTiA9ICdwYXlwYWxwbHVzX2Vjc19jYXJ0X2J1dHRvbidcblxuY29uc3QgVEFTS19DUkVBVEVfT1JERVIgPSAnY3JlYXRlT3JkZXInXG5jb25zdCBUQVNLX1NUT1JFX1BBWU1FTlRfREFUQSA9ICdzdG9yZVBheW1lbnREYXRhJ1xuXG4vKipcbiAqIENsYXNzIFNtYXJ0IFBheW1lbnQgQnV0dG9uIFJlbmRlcmVyXG4gKlxuICogQHR5cGUge1NtYXJ0UGF5bWVudEJ1dHRvblJlbmRlcmVyfVxuICovXG5jb25zdCBTbWFydFBheW1lbnRCdXR0b25SZW5kZXJlciA9IGNsYXNzIFNtYXJ0UGF5bWVudEJ1dHRvblJlbmRlcmVyXG57XG4gIC8qKlxuICAgKiBDb25zdHJ1Y3RvclxuICAgKlxuICAgKiBAcGFyYW0gYnV0dG9uQ29uZmlndXJhdGlvblxuICAgKiBAcGFyYW0gdmFsaWRDb250ZXh0c1xuICAgKiBAcGFyYW0gcmVxdWVzdFxuICAgKi9cbiAgY29uc3RydWN0b3IgKGJ1dHRvbkNvbmZpZ3VyYXRpb24sIHZhbGlkQ29udGV4dHMsIHJlcXVlc3QpXG4gIHtcbiAgICB0aGlzLmJ1dHRvbkNvbmZpZ3VyYXRpb24gPSBidXR0b25Db25maWd1cmF0aW9uXG4gICAgdGhpcy52YWxpZENvbnRleHRzID0gQXJyYXkuZnJvbSh2YWxpZENvbnRleHRzKVxuICAgIHRoaXMucmVxdWVzdCA9IHJlcXVlc3RcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW5kZXIgYnV0dG9uIGZvciBzaW5nbGUgcHJvZHVjdFxuICAgKi9cbiAgc2luZ2xlUHJvZHVjdEJ1dHRvblJlbmRlciAoKVxuICB7XG4gICAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke1NJTkdMRV9QUk9EVUNUX0JVVFRPTn1gKVxuICAgIGVsZW1lbnQgJiYgdGhpcy5yZW5kZXIoZWxlbWVudClcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW5kZXIgQnV0dG9uIGZvciBDYXJ0XG4gICAqL1xuICBjYXJ0QnV0dG9uUmVuZGVyICgpXG4gIHtcbiAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgIyR7Q0FSVF9CVVRUT059YClcbiAgICBlbGVtZW50ICYmIHRoaXMucmVuZGVyKGVsZW1lbnQpXG4gIH1cblxuICAvKipcbiAgICogUmVuZGVyIEJ1dHRvbiBmb3IgdGhlIEdpdmVuIEVsZW1lbnRcbiAgICpcbiAgICogQHBhcmFtIGVsZW1lbnRcbiAgICogQHJldHVybnMgeyp9XG4gICAqL1xuICAvLyBUT0RPIE1ha2UgaXQgcHJpdmF0ZVxuICByZW5kZXIgKGVsZW1lbnQpXG4gIHtcbiAgICBpZiAoXy5pc1VuZGVmaW5lZChwYXlwYWwpKSB7XG4gICAgICByZXR1cm5cbiAgICB9XG5cbiAgICBwYXlwYWwuQnV0dG9uLnJlbmRlcih7XG4gICAgICAuLi50aGlzLmJ1dHRvbkNvbmZpZ3VyYXRpb24sXG5cbiAgICAgIC8qKlxuICAgICAgICogRG8gUGF5bWVudFxuICAgICAgICpcbiAgICAgICAqIEByZXR1cm5zIHsqfVxuICAgICAgICovXG4gICAgICBwYXltZW50OiAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGZvcm1EYXRhID0gdGhpcy5mb3JtRGF0YUJ5RWxlbWVudChlbGVtZW50KVxuICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ3Rhc2snLCBUQVNLX0NSRUFURV9PUkRFUilcblxuICAgICAgICByZXR1cm4gdGhpcy5yZXF1ZXN0XG4gICAgICAgICAgLnN1Ym1pdChmb3JtRGF0YSlcbiAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgICAgICBpZiAoISgnZGF0YScgaW4gcmVzcG9uc2UpKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUud2FybignVW5hYmxlIHRvIHByb2Nlc3MgdGhlIHBheW1lbnQsIHNlcnZlciBkaWQgbm90IHJlc3BvbnNlIHdpdGggdmFsaWQgZGF0YScpXG4gICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gdGhpcy5idXR0b25Db25maWd1cmF0aW9uLnJlZGlyZWN0X3VybHMuY2FuY2VsX3VybFxuICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gdGhpcy5idXR0b25Db25maWd1cmF0aW9uLnJlZGlyZWN0X3VybHMuY2FuY2VsX3VybFxuICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3Qgb3JkZXJJZCA9ICdvcmRlcklEJyBpbiByZXNwb25zZS5kYXRhID8gcmVzcG9uc2UuZGF0YS5vcmRlcklEIDogJydcblxuICAgICAgICAgICAgaWYgKCFvcmRlcklkKSB7XG4gICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gdGhpcy5idXR0b25Db25maWd1cmF0aW9uLnJlZGlyZWN0X3VybHMuY2FuY2VsX3VybFxuICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIG9yZGVySWRcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgICAgICBjb25zdCB0ZXh0U3RhdHVzID0gJ3RleHRTdGF0dXMnIGluIGVycm9yID8gZXJyb3IudGV4dFN0YXR1cyA6ICdVbmtub3duIEVycm9yIGR1cmluZyBwYXltZW50J1xuICAgICAgICAgICAgY29uc29sZS53YXJuKHRleHRTdGF0dXMpXG4gICAgICAgICAgfSlcbiAgICAgIH0sXG5cbiAgICAgIC8qKlxuICAgICAgICogRXhlY3V0ZSBBdXRob3JpemF0aW9uXG4gICAgICAgKlxuICAgICAgICogQHBhcmFtIGRhdGFcbiAgICAgICAqIEBwYXJhbSBhY3Rpb25zXG4gICAgICAgKiBAcmV0dXJucyB7Kn1cbiAgICAgICAqL1xuICAgICAgb25BdXRob3JpemU6IChkYXRhLCBhY3Rpb25zKSA9PiB7XG4gICAgICAgIC8vIFRPRE8gRW5zdXJlIHJldHVybl91cmwgZXhpc3RzLlxuICAgICAgICBjb25zdCBmb3JtRGF0YSA9IHRoaXMuZm9ybURhdGFCeUVsZW1lbnQoZWxlbWVudClcblxuICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ3Rhc2snLCBUQVNLX1NUT1JFX1BBWU1FTlRfREFUQSlcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdvcmRlcklEJywgZGF0YS5vcmRlcklEKVxuICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ3BheWVySUQnLCBkYXRhLnBheWVySUQpXG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZCgncGF5bWVudElEJywgZGF0YS5wYXltZW50SUQpXG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZCgncGF5bWVudFRva2VuJywgZGF0YS5wYXltZW50VG9rZW4pXG5cbiAgICAgICAgcmV0dXJuIHRoaXMucmVxdWVzdFxuICAgICAgICAgIC5zdWJtaXQoZm9ybURhdGEpXG4gICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICBpZiAoIXJlc3BvbnNlLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSB0aGlzLmJ1dHRvbkNvbmZpZ3VyYXRpb24ucmVkaXJlY3RfdXJscy5jYW5jZWxfdXJsXG4gICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm5cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCByZXR1cm5VcmwgPSAncmV0dXJuVXJsJyBpbiBkYXRhID8gZGF0YS5yZXR1cm5VcmwgOiAnJ1xuICAgICAgICAgICAgcmV0dXJuVXJsICYmIGFjdGlvbnMucmVkaXJlY3QobnVsbCwgcmV0dXJuVXJsKVxuICAgICAgICAgIH0pXG4gICAgICB9LFxuXG4gICAgICAvKipcbiAgICAgICAqIFBlcmZvcm0gQWN0aW9uIHdoZW4gYSBQYXltZW50IGdldCBDYW5jZWxsZWRcbiAgICAgICAqXG4gICAgICAgKiBAcGFyYW0gZGF0YVxuICAgICAgICogQHBhcmFtIGFjdGlvbnNcbiAgICAgICAqL1xuICAgICAgb25DYW5jZWw6IChkYXRhLCBhY3Rpb25zKSA9PiB7XG4gICAgICAgIGFjdGlvbnMuY2xvc2UoKVxuICAgICAgICBjb25zdCBjYW5jZWxVcmwgPSAnY2FuY2VsVXJsJyBpbiBkYXRhID8gZGF0YS5jYW5jZWxVcmwgOiAnJ1xuICAgICAgICBjYW5jZWxVcmwgJiYgYWN0aW9ucy5yZWRpcmVjdChudWxsLCBjYW5jZWxVcmwpXG4gICAgICB9LFxuXG4gICAgICBvbkVycm9yOiAoZGF0YSwgYWN0aW9ucykgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygnT04gRVJST1InLCBkYXRhLCBhY3Rpb25zKVxuICAgICAgICAvLyBUT0RPIFJlZGlyZWN0IHRvIGNhcnQgYW5kIHNob3cgY3VzdG9taXphYmxlIG5vdGljZSB3aXRoIG1lc3NhZ2UuXG4gICAgICB9XG5cbiAgICB9LCBlbGVtZW50KVxuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlIGNvbnRleHQgZm9yIEZvcm1EYXRhIGluc3RhbmNlIGJ5IHRoZSBHaXZlbiBFbGVtZW50XG4gICAqXG4gICAqIEBwYXJhbSBlbGVtZW50XG4gICAqIEByZXR1cm5zIHtGb3JtRGF0YX1cbiAgICovXG4gIC8vIFRPRE8gTWFrZSBpdCBwcml2YXRlIGlmIG5vdCBwb3NzaWJsZSBtb3ZlIGl0IGFzIGNsb3N1cmUgd2l0aGluIHRoZSByZW5kZXIgZnVuY3Rpb24uXG4gIGZvcm1EYXRhQnlFbGVtZW50IChlbGVtZW50KVxuICB7XG4gICAgbGV0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKClcbiAgICBjb25zdCBjb250ZXh0ID0gY29udGV4dEJ5RWxlbWVudChlbGVtZW50KVxuXG4gICAgaWYgKCF0aGlzLnZhbGlkQ29udGV4dHMuaW5jbHVkZXMoY29udGV4dCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgJ0ludmFsaWQgY29udGV4dCB3aGVuIHRyeSB0byByZXRyaWV2ZSB0aGUgZm9ybSBkYXRhIGR1cmluZyBleHByZXNzIGNoZWNrb3V0IHJlcXVlc3QuJ1xuICAgICAgKVxuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBzd2l0Y2ggKGNvbnRleHQpIHtcbiAgICAgICAgY2FzZSAnY2FydCc6XG4gICAgICAgICAgZm9ybURhdGEgPSBmb3JtRGF0YUZvckNhcnQoZWxlbWVudClcbiAgICAgICAgICBicmVha1xuICAgICAgICBjYXNlICdwcm9kdWN0JzpcbiAgICAgICAgICBmb3JtRGF0YSA9IGZvcm1EYXRhQnlFbGVtZW50KGVsZW1lbnQpXG4gICAgICAgICAgYnJlYWtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICB9XG5cbiAgICByZXR1cm4gZm9ybURhdGFcbiAgfVxufVxuXG4vKipcbiAqIFNtYXJ0IFBheW1lbnQgQnV0dG9uIFJlbmRlcmVyIEZhY3RvcnlcbiAqXG4gKiBAcGFyYW0gYnV0dG9uQ29uZmlndXJhdGlvblxuICogQHBhcmFtIHZhbGlkQ29udGV4dHNcbiAqIEBwYXJhbSByZXF1ZXN0XG4gKiBAcmV0dXJucyB7U21hcnRQYXltZW50QnV0dG9uUmVuZGVyZXJ9XG4gKiBAY29uc3RydWN0b3JcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIFNtYXJ0UGF5bWVudEJ1dHRvblJlbmRlcmVyRmFjdG9yeSAoYnV0dG9uQ29uZmlndXJhdGlvbiwgdmFsaWRDb250ZXh0cywgcmVxdWVzdClcbntcbiAgY29uc3Qgb2JqZWN0ID0gbmV3IFNtYXJ0UGF5bWVudEJ1dHRvblJlbmRlcmVyKGJ1dHRvbkNvbmZpZ3VyYXRpb24sIHZhbGlkQ29udGV4dHMsIHJlcXVlc3QpXG5cbiAgT2JqZWN0LmZyZWV6ZShvYmplY3QpXG5cbiAgcmV0dXJuIG9iamVjdFxufVxuIiwiaW1wb3J0IHsgUmVxdWVzdEZhY3RvcnkgfSBmcm9tICcuL2V4cHJlc3NDaGVja291dC9SZXF1ZXN0J1xuaW1wb3J0IHsgU21hcnRQYXltZW50QnV0dG9uUmVuZGVyZXJGYWN0b3J5IH0gZnJvbSAnLi9leHByZXNzQ2hlY2tvdXQvc21hcnRQYXltZW50QnV0dG9uJ1xuXG4oZnVuY3Rpb24gKGpRdWVyeSwgXywgZXhwcmVzc0NoZWNrb3V0RGF0YSkge1xuICAvKipcbiAgICogRW5zdXJlIHRoZSBHbG9iYWwgRXhwcmVzcyBDaGVja291dCBpcyBhIFZhbGlkIFZhbHVlXG4gICAqIEByZXR1cm5zIHtib29sZWFufVxuICAgKi9cbiAgZnVuY3Rpb24gaXNWYWxpZEV4cHJlc3NDaGVja291dERhdGEgKClcbiAge1xuICAgIHJldHVybiAhXy5pc1VuZGVmaW5lZChleHByZXNzQ2hlY2tvdXREYXRhKSAmJiAhXy5pc0VtcHR5KGV4cHJlc3NDaGVja291dERhdGEpXG4gIH1cblxuICAvKipcbiAgICogQm9vdHN0cmFwIEV4cHJlc3MgY2hlY2tvdXRcbiAgICogQHJldHVybnMgdm9pZFxuICAgKi9cbiAgZnVuY3Rpb24gYm9vdHN0cmFwRXhwcmVzc0NoZWNrb3V0ICgpXG4gIHtcbiAgICBpZiAoIWlzVmFsaWRFeHByZXNzQ2hlY2tvdXREYXRhKCkpIHtcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIGNvbnN0IHJlcXVlc3REYXRhID0gZXhwcmVzc0NoZWNrb3V0RGF0YS5yZXF1ZXN0XG4gICAgaWYgKCFfLmlzT2JqZWN0KHJlcXVlc3REYXRhKSkge1xuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgY29uc3QgdmFsaWRDb250ZXh0cyA9IGV4cHJlc3NDaGVja291dERhdGEudmFsaWRDb250ZXh0c1xuICAgIGlmICghXy5pc0FycmF5KHZhbGlkQ29udGV4dHMpKSB7XG4gICAgICByZXR1cm5cbiAgICB9XG5cbiAgICBjb25zdCByZXF1ZXN0ID0gUmVxdWVzdEZhY3RvcnkocmVxdWVzdERhdGEuYWpheFVybCwgcmVxdWVzdERhdGEuYWN0aW9uKVxuICAgIGNvbnN0IHNtYXJ0UGF5bWVudEJ1dHRvbiA9IFNtYXJ0UGF5bWVudEJ1dHRvblJlbmRlcmVyRmFjdG9yeShcbiAgICAgIGV4cHJlc3NDaGVja291dERhdGEsXG4gICAgICB2YWxpZENvbnRleHRzLFxuICAgICAgcmVxdWVzdFxuICAgIClcblxuICAgIHNtYXJ0UGF5bWVudEJ1dHRvbi5zaW5nbGVQcm9kdWN0QnV0dG9uUmVuZGVyKClcbiAgICBzbWFydFBheW1lbnRCdXR0b24uY2FydEJ1dHRvblJlbmRlcigpXG4gICAgalF1ZXJ5KGRvY3VtZW50LmJvZHkpLm9uKCd3Y19mcmFnbWVudHNfcmVmcmVzaGVkIHJlbW92ZWRfZnJvbV9jYXJ0IGFkZGVkX3RvX2NhcnQnLCAoKSA9PiB7XG4gICAgICBzbWFydFBheW1lbnRCdXR0b24uY2FydEJ1dHRvblJlbmRlcigpXG4gICAgfSlcbiAgfVxuXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgKCkgPT4ge1xuICAgIGJvb3RzdHJhcEV4cHJlc3NDaGVja291dCgpXG4gIH0pXG59KShqUXVlcnksIHdpbmRvdy5fLCB3aW5kb3cud29vUGF5UGFsUGx1c0V4cHJlc3NDaGVja291dClcbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///1\n")}]);
>>>>>>> Redirect user with a message if something goes wrong during the ECS steps
//# sourceMappingURL=expressCheckout.min.js.map